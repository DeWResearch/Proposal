"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,r=require("@aragon/osx-ethers"),n=require("@ethersproject/abi"),a=require("@ethersproject/bignumber"),s=require("@ethersproject/constants"),o=require("@ethersproject/contracts"),i=require("@openzeppelin/contracts/build/contracts/ERC20.json"),u=require("@openzeppelin/contracts/build/contracts/ERC721.json"),c=require("@openzeppelin/contracts/build/contracts/ERC1155.json"),d=require("graphql-request"),p=require("@ethersproject/keccak256"),l=require("@ethersproject/strings"),f=require("@aragon/sdk-client-common"),m=require("yup"),g=require("@ethersproject/address"),h=require("@ethersproject/hash"),v=require("@aragon/osx-commons-configs"),A=require("@openzeppelin/contracts/build/contracts/IVotes.json"),I=require("@openzeppelin/contracts-upgradeable/build/contracts/IVotesUpgradeable.json"),y=require("@openzeppelin/contracts/build/contracts/ERC165.json");function E(e){var t,r;function n(t,r){try{var s=e[t](r),o=s.value,i=o instanceof P;Promise.resolve(i?o.v:o).then((function(r){if(i){var u="return"===t?"return":"next";if(!o.k||r.done)return n(u,r);r=e[u](r).value}a(s.done?"return":"normal",r)}),(function(e){n("throw",e)}))}catch(e){a("throw",e)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,a){return new Promise((function(s,o){var i={key:e,arg:a,resolve:s,reject:o,next:null};r?r=r.next=i:(t=r=i,n(e,a))}))},"function"!=typeof e.return&&(this.return=void 0)}function P(e,t){this.v=e,this.k=t}function w(e){var t={},r=!1;function n(t,n){return r=!0,n=new Promise((function(r){r(e[t](n))})),{done:!1,value:new P(n,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):n("return",e)}),t}function S(e){var t,r,n,a=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);a--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new b(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function b(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return b=function(e){this.s=e,this.n=e.next},b.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new b(e)}function _(e){return new P(e,0)}function x(){x=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",i=s.asyncIterator||"@@asyncIterator",u=s.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var s=Object.create((t&&t.prototype instanceof v?t:v).prototype),o=new D(n||[]);return a(s,"_invoke",{value:_(e,r,o)}),s}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var l="suspendedStart",f="suspendedYield",m="executing",g="completed",h={};function v(){}function A(){}function I(){}var y={};c(y,o,(function(){return this}));var E=Object.getPrototypeOf,P=E&&E(E(R([])));P&&P!==r&&n.call(P,o)&&(y=P);var w=I.prototype=v.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(a,s,o,i){var u=p(e[a],e,s);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,i)}),(function(e){r("throw",e,o,i)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,i)}))}i(u.arg)}var s;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return s=s?s.then(a,a):a()}})}function _(t,r,n){var a=l;return function(s,o){if(a===m)throw new Error("Generator is already running");if(a===g){if("throw"===s)throw o;return{value:e,done:!0}}for(n.method=s,n.arg=o;;){var i=n.delegate;if(i){var u=T(i,n);if(u){if(u===h)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===l)throw a=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var c=p(t,r,n);if("normal"===c.type){if(a=n.done?g:f,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a=g,n.method="throw",n.arg=c.arg)}}}function T(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var s=p(a,t.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,h;var o=s.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function R(t){if(t||""===t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,s=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(typeof t+" is not iterable")}return A.prototype=I,a(w,"constructor",{value:I,configurable:!0}),a(I,"constructor",{value:A,configurable:!0}),A.displayName=c(I,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===A||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,I):(e.__proto__=I,c(e,u,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},S(b.prototype),c(b.prototype,i,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,a,s){void 0===s&&(s=Promise);var o=new b(d(e,r,n,a),s);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(w),c(w,u,"Generator"),c(w,o,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=R,D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return i.type="throw",i.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],i=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;O(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:R(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function T(e){return function(){return new E(e.apply(this,arguments))}}function k(e,t,r,n,a,s,o){try{var i=e[s](o),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function O(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function o(e){k(s,n,a,o,i,"next",e)}function i(e){k(s,n,a,o,i,"throw",e)}o(void 0)}))}}function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},D.apply(this,arguments)}function R(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,N(e,t)}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function C(e,t){return t||(t=e.slice(0)),e.raw=t,e}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function V(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return U(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?U(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}E.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},E.prototype.next=function(e){return this._invoke("next",e)},E.prototype.throw=function(e){return this._invoke("throw",e)},E.prototype.return=function(e){return this._invoke("return",e)};var L,B,M,G,q,F,$,H,W,j,K,Y,Z,X,z,J,Q,ee,te,re=d.gql(e||(e=C(["\n  query Dao($address: ID!) {\n    dao(id: $address){\n      id\n      subdomain\n      metadata\n      createdAt\n      plugins{\n        appliedPreparation {\n          pluginAddress\n        }\n        appliedPluginRepo {\n          subdomain\n        }\n        appliedVersion{\n          build\n          release {\n            release\n          }\n        }\n      }\n    }\n  }\n"]))),ne=d.gql(t||(t=C(["\n  query Daos ($limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: Dao_orderBy!) {\n    daos(first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n      id\n      subdomain\n      metadata\n      plugins{\n        appliedPreparation {\n          pluginAddress\n        }\n        appliedPluginRepo {\n          subdomain\n        }\n        appliedVersion{\n          build\n          release {\n            release\n          }\n        }\n      }\n    }\n  }\n"]))),ae=d.gql(L||(L=C(["\nquery TokenBalances($where: TokenBalance_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: TokenBalance_orderBy!) {\n  tokenBalances (where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy) {\n    lastUpdated\n    __typename\n    ... on ERC20Balance {\n      balance\n      token {\n        name\n        decimals\n        symbol\n        id\n      }\n    }\n    ... on ERC721Balance {\n      token {\n        name\n        symbol\n        id\n      }\n      tokenIds\n    }\n    ... on NativeBalance {\n      balance\n    }\n    ... on ERC1155Balance {\n      metadataUri\n      token {\n        id\n      }\n      balances {\n        amount\n        id\n        tokenId\n      }\n    }\n  }\n}\n"]))),se=d.gql(B||(B=C(["\nquery TokenTransfers($where: TokenTransfer_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: TokenTransfer_orderBy!) {\n  tokenTransfers (where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy) {\n    from\n    to\n    type\n    createdAt\n    txHash\n    proposal{\n      id\n    }\n    __typename\n    ... on ERC20Transfer {\n      amount\n      token {\n        ...on ERC20Contract {\n          id\n          name\n          symbol\n          decimals\n        }\n      }\n    }\n    ... on ERC721Transfer {\n      token{\n      \tid\n        name\n        symbol\n      }\n      \n    }\n    ... on NativeTransfer {\n      amount\n    }\n    ...on ERC1155Transfer{\n      amount\n      tokenId\n      token {\n        id\n      }\n    }\n  }\n}\n"]))),oe=d.gql(M||(M=C(["\nquery Plugins($where: PluginRepo_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: PluginRepo_orderBy!) {\n  pluginRepos(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    subdomain\n    releases (orderBy: release, orderDirection: desc){\n      release\n      metadata\n      builds (orderBy: build, orderDirection: desc) {\n        build\n        metadata\n      }\n    }\n  }\n}\n"]))),ie=d.gql(G||(G=C(["\nquery Plugin($id: ID!) {\n  pluginRepo(id:$id){\n    id\n    subdomain\n    releases(orderBy: release, orderDirection: desc){\n      release\n      metadata\n      builds(orderBy: build, orderDirection: desc){\n        build\n        metadata\n      }\n    }\n  }\n}\n"]))),ue=d.gql(q||(q=C(["\nquery IPlugin($address: ID!, $where: IPlugin_filter!) {\n\tiplugin(id:$address, where:$where){\n    installations(where:{state: Installed}) {\n      appliedPreparation{\n        helpers\n        pluginRepo {\n          id\n        }\n      }\n     \tappliedVersion {\n        metadata\n        build\n        release{\n          release\n        }\n      }\n    }   \n  }\n}\n"]))),ce=d.gql(F||(F=C(["\nquery PluginPreparations($where: PluginPreparation_filter!) {\n  pluginPreparations(where: $where){\n    data\n  }\n}\n"]))),de=d.gql($||($=C(["\nquery PluginPreparations($where: PluginPreparation_filter!, $limit: Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: PluginPreparation_orderBy!) {\n  pluginPreparations(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    type\n    creator\n    dao {\n      id\n    }\n    pluginRepo {\n      id\n      subdomain\n    }\n    pluginVersion{\n      build\n      release{\n        release\n      }\n    }\n    pluginAddress\n    permissions {\n      id\n      operation\n      where\n      who\n      condition\n    }\n    helpers\n    data\n  }\n}\n"]))),pe=d.gql(H||(H=C(["\n  query PluginInstallations($where: PluginInstallation_filter!) {\n    pluginInstallations(where: $where) {\n      id\n    }\n  }"]))),le=d.gql(W||(W=C(["\nquery IProposal($id: String!) {\n    iproposal(id: $id) {\n        dao {\n            id\n        }\n        allowFailureMap\n        actions {\n            to\n            value\n            data\n        }\n    }\n}\n"])));exports.DaoCreationSteps=void 0,(j=exports.DaoCreationSteps||(exports.DaoCreationSteps={})).CREATING="creating",j.DONE="done",exports.DaoSortBy=void 0,(K=exports.DaoSortBy||(exports.DaoSortBy={})).CREATED_AT="createdAt",K.SUBDOMAIN="subdomain",exports.PluginSortBy=void 0,(exports.PluginSortBy||(exports.PluginSortBy={})).SUBDOMAIN="subdomain",exports.DaoDepositSteps=void 0,(Y=exports.DaoDepositSteps||(exports.DaoDepositSteps={})).CHECKED_ALLOWANCE="checkedAllowance",Y.DEPOSITING="depositing",Y.DONE="done",exports.AssetBalanceSortBy=void 0,(exports.AssetBalanceSortBy||(exports.AssetBalanceSortBy={})).LAST_UPDATED="lastUpdated",exports.TransferType=void 0,(Z=exports.TransferType||(exports.TransferType={})).DEPOSIT="deposit",Z.WITHDRAW="withdraw",exports.TransferSortBy=void 0,(exports.TransferSortBy||(exports.TransferSortBy={})).CREATED_AT="createdAt",exports.SetAllowanceSteps=void 0,(X=exports.SetAllowanceSteps||(exports.SetAllowanceSteps={})).SETTING_ALLOWANCE="settingAllowance",X.ALLOWANCE_SET="allowanceSet",exports.ProposalSettingsErrorCause=void 0,(z=exports.ProposalSettingsErrorCause||(exports.ProposalSettingsErrorCause={})).NON_ZERO_ALLOW_FAILURE_MAP_VALUE="nonZeroAllowFailureMapValue",z.INVALID_ACTIONS="invalidActions",z.PROPOSAL_NOT_FOUND="proposalNotFound",exports.PluginUpdateProposalInValidityCause=void 0,(J=exports.PluginUpdateProposalInValidityCause||(exports.PluginUpdateProposalInValidityCause={})).INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_WHO_ADDRESS="invalidGrantUpgradePluginPermissionWhoAddress",J.INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_WHERE_ADDRESS="invalidGrantUpgradePluginPermissionWhereAddress",J.INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_PERMISSION_NAME="invalidGrantUpgradePluginPermissionPermissionName",J.NON_ZERO_GRANT_UPGRADE_PLUGIN_PERMISSION_CALL_VALUE="nonZeroGrantUpgradePluginPermissionCallValue",J.INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_PERMISSION_ID="invalidGrantUpgradePluginPermissionPermissionId",J.INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_TO_ADDRESS="invalidGrantUpgradePluginPermissionToAddress",J.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_WHO_ADDRESS="invalidRevokeUpgradePluginPermissionWhoAddress",J.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_WHERE_ADDRESS="invalidRevokeUpgradePluginPermissionWhereAddress",J.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_PERMISSION_NAME="invalidRevokeUpgradePluginPermissionPermissionName",J.NON_ZERO_REVOKE_UPGRADE_PLUGIN_PERMISSION_CALL_VALUE="nonZeroRevokeUpgradePluginPermissionCallValue",J.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_PERMISSION_ID="invalidRevokeUpgradePluginPermissionPermissionId",J.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_TO_ADDRESS="invalidRevokeUpdatePluginPermissionToAddress",J.INVALID_GRANT_ROOT_PERMISSION_WHO_ADDRESS="invalidGrantRootPermissionWhoAddress",J.INVALID_GRANT_ROOT_PERMISSION_WHERE_ADDRESS="invalidGrantRootPermissionWhereAddress",J.INVALID_GRANT_ROOT_PERMISSION_PERMISSION_NAME="invalidGrantRootPermissionPermissionName",J.NON_ZERO_GRANT_ROOT_PERMISSION_CALL_VALUE="nonZeroGrantRootPermissionCallValue",J.INVALID_GRANT_ROOT_PERMISSION_PERMISSION_ID="invalidGrantRootPermissionPermissionId",J.INVALID_GRANT_ROOT_PERMISSION_TO_ADDRESS="invalidGrantRootPermissionToAddress",J.INVALID_REVOKE_ROOT_PERMISSION_WHO_ADDRESS="invalidRevokeRootPermissionWhoAddress",J.INVALID_REVOKE_ROOT_PERMISSION_WHERE_ADDRESS="invalidRevokeRootPermissionWhereAddress",J.INVALID_REVOKE_ROOT_PERMISSION_PERMISSION_NAME="invalidRevokeRootPermissionPermissionName",J.NON_ZERO_REVOKE_ROOT_PERMISSION_CALL_VALUE="nonZeroRevokeRootPermissionCallValue",J.INVALID_REVOKE_ROOT_PERMISSION_PERMISSION_ID="invalidRevokeRootPermissionPermissionId",J.INVALID_REVOKE_ROOT_PERMISSION_TO_ADDRESS="invalidRevokeRootPermissionToAddress",J.NON_ZERO_APPLY_UPDATE_CALL_VALUE="nonZeroApplyUpdateCallValue",J.PLUGIN_NOT_INSTALLED="pluginNotInstalled",J.NOT_ARAGON_PLUGIN_REPO="notAragonPluginRepo",J.MISSING_PLUGIN_REPO="missingPluginRepo",J.MISSING_PLUGIN_PREPARATION="missingPluginPreparation",J.UPDATE_TO_INCOMPATIBLE_RELEASE="updateToIncompatibleRelease",J.UPDATE_TO_OLDER_OR_SAME_BUILD="updateToOlderOrSameBuild",J.INVALID_DATA="invalidData",J.INVALID_PLUGIN_REPO_METADATA="invalidPluginRepoMetadata",exports.DaoUpdateProposalInvalidityCause=void 0,(Q=exports.DaoUpdateProposalInvalidityCause||(exports.DaoUpdateProposalInvalidityCause={})).NON_ZERO_CALL_VALUE="nonZeroCallValue",Q.INVALID_TO_ADDRESS="invalidToAddress",Q.INVALID_UPGRADE_TO_IMPLEMENTATION_ADDRESS="invalidUpgradeToImplementationAddress",Q.INVALID_UPGRADE_TO_AND_CALL_DATA="invalidUpgradeToAndCallData",Q.INVALID_UPGRADE_TO_AND_CALL_IMPLEMENTATION_ADDRESS="invalidUpgradeToAndCallImplementationAddress",Q.INVALID_UPGRADE_TO_AND_CALL_VERSION="invalidUpgradeToAndCallVersion",exports.PluginPreparationType=void 0,(ee=exports.PluginPreparationType||(exports.PluginPreparationType={})).INSTALLATION="Installation",ee.UPDATE="Update",ee.UNINSTALLATION="Uninstallation",exports.PluginPreparationSortBy=void 0,(exports.PluginPreparationSortBy||(exports.PluginPreparationSortBy={})).ID="id",function(e){e.DEPOSIT="Deposit",e.WITHDRAW="Withdraw"}(te||(te={}));var fe,me,ge=new Map([[exports.TransferType.DEPOSIT,te.DEPOSIT],[exports.TransferType.WITHDRAW,te.WITHDRAW]]);!function(e){e.GRANT="Grant",e.REVOKE="Revoke",e.GRANT_WITH_CONDITION="GrantWithCondition"}(fe||(fe={})),function(e){e.UPGRADE_TO="upgradeTo",e.UPGRADE_TO_AND_CALL="upgradeToAndCall",e.APPLY_UPDATE="applyUpdate",e.GRANT_PLUGIN_UPGRADE_PERMISSION="grantUpgradePluginPermission",e.REVOKE_PLUGIN_UPGRADE_PERMISSION="revokeUpgradePluginPermission",e.GRANT_ROOT_PERMISSION="grantRootPermission",e.REVOKE_ROOT_PERMISSION="revokeRootPermission",e.ACTION_NOT_ALLOWED="actionNotAllowed",e.UNKNOWN="unknown"}(me||(me={}));var he,ve=[new o.Contract(s.AddressZero,i.abi).interface.getFunction("transfer").format("minimal"),new o.Contract(s.AddressZero,u.abi).interface.getFunction("safeTransferFrom(address,address,uint256)").format("minimal"),r.DAO__factory.createInterface().getFunction("grant").format("minimal"),r.DAO__factory.createInterface().getFunction("grantWithCondition").format("minimal"),r.DAO__factory.createInterface().getFunction("revoke").format("minimal"),r.DAO__factory.createInterface().getFunction("setMetadata").format("minimal"),r.DAO__factory.createInterface().getFunction("setDaoURI").format("minimal"),r.DAO__factory.createInterface().getFunction("registerStandardCallback").format("minimal"),r.DAO__factory.createInterface().getFunction("setSignatureValidator").format("minimal"),r.DAO__factory.createInterface().getFunction("upgradeTo").format("minimal"),r.DAO__factory.createInterface().getFunction("upgradeToAndCall").format("minimal")],Ae={name:"(unsupported metadata link)",description:"(the metadata link is not supported)",links:[]},Ie={name:"(the DAO has no metadata)",description:"(the DAO did not define any content)",links:[]},ye={name:"(unavailable metadata)",description:"(the DAO metadata is not available)",links:[]},Ee={name:"(unsupported metadata link)",description:"(the metadata link is not supported)",images:{}},Pe={name:"(the release has no metadata)",description:"(the release did not define any content)",images:{}},we={name:"(unavailable metadata)",description:"(the release metadata is not available)",images:{}},Se={ui:"",change:"(unsupported metadata link)",pluginSetup:{prepareInstallation:[],prepareUninstallation:[],prepareUpdate:[]}},be={ui:"",change:"(the build has no metadata)",pluginSetup:{prepareInstallation:[],prepareUninstallation:[],prepareUpdate:[]}},_e={ui:"",change:"(unavailable metadata)",pluginSetup:{prepareInstallation:[],prepareUninstallation:[],prepareUpdate:[]}};!function(e){e.ADMIN="admin",e.MULTISIG="multisig",e.TOKEN_VOTING="token-voting",e.ADDRESS_LIST_VOTING="address-list-voting"}(he||(he={}));var xe,Te=Object.values(he);!function(e){e[e.NONE=0]="NONE",e[e.INSTALLATION=1]="INSTALLATION",e[e.UPDATE=2]="UPDATE",e[e.UNINSTALLATION=3]="UNINSTALLATION"}(xe||(xe={}));var ke=[r.DAO__factory.createInterface().getFunction("grant").format("minimal"),r.DAO__factory.createInterface().getFunction("revoke").format("minimal"),r.PluginSetupProcessor__factory.createInterface().getFunction("applyUpdate").format("minimal"),r.DAO__factory.createInterface().getFunction("upgradeTo").format("minimal"),r.DAO__factory.createInterface().getFunction("upgradeToAndCall").format("minimal")],Oe=[me.GRANT_PLUGIN_UPGRADE_PERMISSION,me.APPLY_UPDATE,me.REVOKE_PLUGIN_UPGRADE_PERMISSION],De=[me.GRANT_PLUGIN_UPGRADE_PERMISSION,me.GRANT_ROOT_PERMISSION,me.APPLY_UPDATE,me.REVOKE_ROOT_PERMISSION,me.REVOKE_PLUGIN_UPGRADE_PERMISSION],Re=m.object({metadataUri:f.IpfsUriSchema.required(),daoUri:m.string().url().notRequired(),ensSubdomain:f.SubdomainSchema.notRequired(),trustedForwarder:f.AddressOrEnsSchema.notRequired(),plugins:m.array(f.PluginInstallItemSchema).min(1).required()}),Ne=m.object({name:m.string().required(),description:m.string().required(),avatar:m.mixed().test((function(e){return[f.IpfsUriSchema,m.string().url()].some((function(t){return t.strict().isValidSync(e)}))})).notRequired(),links:m.array(m.object({name:m.string().required(),url:m.string().required()})).required()}),Ce=m.object({type:m.string().required().oneOf(["native"]),daoAddressOrEns:f.AddressOrEnsSchema.required(),amount:f.BigintSchema.required()}),Ue=m.object({type:m.string().required().oneOf(["erc20"]),daoAddressOrEns:f.AddressOrEnsSchema.required(),tokenAddress:f.AddressOrEnsSchema.required(),amount:f.BigintSchema.required()}),Ve=m.object({type:m.string().required().oneOf(["erc721"]),daoAddressOrEns:f.AddressOrEnsSchema.required(),tokenAddress:f.AddressOrEnsSchema.required(),tokenId:f.BigintSchema.required()}),Le=m.object({type:m.string().required().oneOf(["erc1155"]),daoAddressOrEns:f.AddressOrEnsSchema.required(),tokenAddress:f.AddressOrEnsSchema.required(),tokenIds:m.array(f.BigintSchema).required().min(1),amounts:m.array(f.BigintSchema).required().min(1)}).test("isSameLength",new f.SizeMismatchError("tokenIds","amounts").message,(function(e){return!e.tokenIds||!e.amounts||e.tokenIds.length===e.amounts.length})),Be=m.object({tokenAddress:f.AddressOrEnsSchema.required(),amount:f.BigintSchema.required(),spender:f.AddressOrEnsSchema.required()}),Me=m.object({who:f.AddressOrEnsSchema.required(),where:f.AddressOrEnsSchema.required(),permission:m.string().required(),daoAddressOrEns:f.AddressOrEnsSchema.required(),data:f.Uint8ArraySchema.notRequired()}),Ge=f.PaginationSchema.concat(m.object({sortBy:m.string().notRequired().oneOf(["createdAt","subdomain"])})),qe=f.PaginationSchema.concat(m.object({sortBy:m.string().notRequired().oneOf(["lastUpdated"]),daoAddressOrEns:f.AddressOrEnsSchema.notRequired()})),Fe=f.PaginationSchema.concat(m.object({sortBy:m.string().notRequired().oneOf(["subdomain"]),subdomain:f.SubdomainSchema.notRequired()})),$e=m.object({who:f.AddressOrEnsSchema.required(),where:f.AddressOrEnsSchema.required(),permission:m.string().required()}),He=$e.concat(m.object({condition:f.AddressOrEnsSchema.required()})),We=m.object({type:m.string().required().oneOf(["native"]),recipientAddressOrEns:f.AddressOrEnsSchema.required(),amount:f.BigintSchema.required()}),je=m.object({type:m.string().required().oneOf(["erc20"]),recipientAddressOrEns:f.AddressOrEnsSchema.required(),tokenAddress:f.AddressOrEnsSchema.required(),amount:f.BigintSchema.required()}),Ke=m.object({type:m.string().required().oneOf(["erc721"]),daoAddressOrEns:f.AddressOrEnsSchema.required(),recipientAddressOrEns:f.AddressOrEnsSchema.required(),tokenAddress:f.AddressOrEnsSchema.required(),tokenId:f.BigintSchema.required()}),Ye=m.object({type:m.string().required().oneOf(["erc1155"]),daoAddressOrEns:f.AddressOrEnsSchema.required(),recipientAddressOrEns:f.AddressOrEnsSchema.required(),tokenAddress:f.AddressOrEnsSchema.required(),tokenIds:m.array(f.BigintSchema).required().min(1),amounts:m.array(f.BigintSchema).required().min(1)}).test("isSameLength",new f.SizeMismatchError("tokenIds","amounts").message,(function(e){return!e.tokenIds||!e.amounts||e.tokenIds.length===e.amounts.length})),Ze=m.object({interfaceId:m.string().required(),callbackSelector:m.string().required(),magicNumber:m.string().required()}),Xe=m.object({implementationAddress:f.AddressOrEnsSchema.required(),data:f.Uint8ArraySchema.required()}),ze=m.object({previousVersion:m.array().of(m.number()).length(3).required(),initData:f.Uint8ArraySchema.notRequired()}),Je=m.object({previousVersion:m.array().of(m.number()).length(3).required(),initData:f.Uint8ArraySchema.notRequired(),daoFactoryAddress:f.AddressOrEnsSchema.notRequired()}),Qe=f.PaginationSchema.concat(m.object({sortBy:m.string().notRequired().oneOf([exports.PluginPreparationSortBy.ID]),type:m.string().notRequired().oneOf([exports.PluginPreparationType.INSTALLATION,exports.PluginPreparationType.UPDATE]),daoAddressOrEns:f.AddressOrEnsSchema.notRequired(),pluginAddress:f.AddressOrEnsSchema.notRequired(),pluginRepoAddress:f.AddressOrEnsSchema.notRequired()}));function et(e,t){return{address:e.id,ensDomain:e.subdomain+".dao.eth",metadata:{name:t.name,description:t.description,avatar:t.avatar||void 0,links:t.links},metadataHash:e.metadata,creationDate:new Date(1e3*parseInt(e.createdAt)),plugins:e.plugins.filter((function(e){return e.appliedPreparation&&e.appliedVersion&&e.appliedPluginRepo})).map((function(e){return{id:e.appliedPluginRepo.subdomain+".plugin.dao.eth",release:e.appliedVersion.release.release,build:e.appliedVersion.build,instanceAddress:e.appliedPreparation.pluginAddress}}))}}function tt(e,t){return{address:e.id,ensDomain:e.subdomain+".dao.eth",metadata:{name:t.name,description:t.description,avatar:t.avatar||void 0},metadataHash:e.metadata,plugins:e.plugins.filter((function(e){return e.appliedPreparation&&e.appliedVersion&&e.appliedPluginRepo})).map((function(e){return{id:e.appliedPluginRepo.subdomain+".plugin.dao.eth",release:e.appliedVersion.release.release,build:e.appliedVersion.build,instanceAddress:e.appliedPreparation.pluginAddress}}))}}function rt(e){switch(e.__typename){case"NativeBalance":return function(e){return{id:e.id,type:f.TokenType.NATIVE,balance:BigInt(e.balance),updateDate:new Date(1e3*parseInt(e.lastUpdated))}}(e);case"ERC20Balance":return function(e){return{id:e.id,type:f.TokenType.ERC20,address:e.token.id,name:e.token.name,symbol:e.token.symbol,decimals:e.token.decimals,balance:BigInt(e.balance),updateDate:new Date(1e3*parseInt(e.lastUpdated))}}(e);case"ERC721Balance":return function(e){return{id:e.id,type:f.TokenType.ERC721,address:e.token.id,name:e.token.name,symbol:e.token.symbol,updateDate:new Date(1e3*parseInt(e.lastUpdated)),tokenIds:e.tokenIds.map((function(e){return BigInt(e)}))}}(e);case"ERC1155Balance":return function(e){return{id:e.id,type:f.TokenType.ERC1155,address:e.token.id,metadataUri:e.metadataUri,updateDate:new Date(1e3*parseInt(e.lastUpdated)),balances:e.balances.map((function(e){return{tokenId:BigInt(e.tokenId),amount:BigInt(e.amount),id:e.id}}))}}(e);default:throw new f.InvalidParameter("Token type not supported")}}function nt(e){switch(e.__typename){case"ERC20Transfer":return function(e){var t,r=new Date(1e3*parseInt(e.createdAt));return e.type===te.DEPOSIT?{type:exports.TransferType.DEPOSIT,tokenType:f.TokenType.ERC20,token:{address:e.token.id,name:e.token.name,symbol:e.token.symbol,decimals:e.token.decimals},amount:BigInt(e.amount),creationDate:r,transactionId:e.txHash,from:e.from,to:e.to}:{type:exports.TransferType.WITHDRAW,tokenType:f.TokenType.ERC20,token:{address:e.token.id,name:e.token.name,symbol:e.token.symbol,decimals:e.token.decimals},amount:BigInt(e.amount),creationDate:r,transactionId:e.txHash,to:e.to,from:e.from,proposalId:(null==(t=e.proposal)?void 0:t.id)||""}}(e);case"ERC721Transfer":return function(e){var t,r=new Date(1e3*parseInt(e.createdAt));return e.type===te.DEPOSIT?{type:exports.TransferType.DEPOSIT,tokenType:f.TokenType.ERC721,token:{address:e.token.id,name:e.token.name,symbol:e.token.symbol},creationDate:r,transactionId:e.txHash,from:e.from,to:e.to}:{type:exports.TransferType.WITHDRAW,tokenType:f.TokenType.ERC721,token:{address:e.token.id,name:e.token.name,symbol:e.token.symbol},creationDate:r,transactionId:e.txHash,to:e.to,from:e.from,proposalId:(null==(t=e.proposal)?void 0:t.id)||""}}(e);case"NativeTransfer":return function(e){var t,r=new Date(1e3*parseInt(e.createdAt));return e.type===te.DEPOSIT?{type:exports.TransferType.DEPOSIT,tokenType:f.TokenType.NATIVE,amount:BigInt(e.amount),creationDate:r,transactionId:e.txHash,from:e.from,to:e.to}:{type:exports.TransferType.WITHDRAW,tokenType:f.TokenType.NATIVE,amount:BigInt(e.amount),creationDate:r,transactionId:e.txHash,proposalId:(null==(t=e.proposal)?void 0:t.id)||"",to:e.to,from:e.from}}(e);case"ERC1155Transfer":return function(e){var t,r=new Date(1e3*parseInt(e.createdAt));return e.type===te.DEPOSIT?{type:exports.TransferType.DEPOSIT,tokenType:f.TokenType.ERC1155,amount:BigInt(e.amount),tokenId:BigInt(e.tokenId),token:{address:e.token.id},creationDate:r,transactionId:e.txHash,from:e.from,to:e.to}:{type:exports.TransferType.WITHDRAW,tokenType:f.TokenType.ERC1155,amount:BigInt(e.amount),tokenId:BigInt(e.tokenId),token:{address:e.token.id},creationDate:r,transactionId:e.txHash,proposalId:(null==(t=e.proposal)?void 0:t.id)||"",to:e.to,from:e.from}}(e);default:throw new f.InvalidParameter("Token type not supported")}}function at(e,t,r){var n,a;return{address:e.id,subdomain:e.subdomain,releases:e.releases.map((function(e){return{release:e.release,metadata:e.metadata,builds:e.builds.map((function(e){return{build:e.build,metadata:e.metadata}}))}})),current:{build:{metadata:r,number:null==(n=e.releases)||null==(n=n[0])||null==(n=n.builds)||null==(n=n[0])?void 0:n.build},release:{metadata:t,number:null==(a=e.releases)||null==(a=a[0])?void 0:a.release}}}}function st(e){var t=e[1];return{helpersHash:t.helpersHash,permissions:t.permissions,versionTag:t.pluginSetupRef.versionTag,pluginAddress:t.plugin,pluginRepo:t.pluginSetupRef.pluginSetupRepo}}function ot(e){return[e.where,e.who,p.keccak256(l.toUtf8Bytes(e.permission))]}function it(e){var t;return{where:e[0],who:e[1],permissionId:e[2],permission:(null==(t=Object.keys(f.PermissionIds).find((function(t){return f.PermissionIds[t]===e[2]})))?void 0:t.replace(/_ID$/,""))||""}}function ut(e,t,r,n,a){switch(n){case f.TokenType.ERC20:return{type:f.TokenType.ERC20,tokenAddress:e,recipientAddressOrEns:r[0],amount:BigInt(r[1])};case f.TokenType.ERC721:return{type:f.TokenType.ERC721,tokenAddress:e,recipientAddressOrEns:r[1],tokenId:BigInt(r[2]),daoAddressOrEns:r[0]};case f.TokenType.ERC1155:var s,o;return a?(s=r[2].map((function(e){return BigInt(e)})),o=r[3].map((function(e){return BigInt(e)}))):(s=[BigInt(r[2])],o=[BigInt(r[3])]),{type:f.TokenType.ERC1155,tokenAddress:e,recipientAddressOrEns:r[1],tokenIds:s,amounts:o,daoAddressOrEns:r[0]}}throw new f.NotImplementedError("Token standard not supported")}function ct(e,t){return dt.apply(this,arguments)}function dt(){return(dt=O(x().mark((function e(t,n){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.strict().validate(n);case 2:return a=r.DAO__factory.connect(n.daoAddressOrEns,t),e.next=5,a.estimateGas.deposit(s.AddressZero,n.amount,"");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pt(e,t){return lt.apply(this,arguments)}function lt(){return(lt=O(x().mark((function e(t,n){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue.strict().validate(n);case 2:return a=r.DAO__factory.connect(n.daoAddressOrEns,t),e.next=5,a.estimateGas.deposit(n.tokenAddress,n.amount,"");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ft(e,t){return mt.apply(this,arguments)}function mt(){return(mt=O(x().mark((function e(t,r){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve.strict().validate(r);case 2:return n=new o.Contract(r.tokenAddress,u.abi,t),e.t0=n.estimateGas,e.next=6,t.getAddress();case 6:return e.t1=e.sent,e.t2=r.daoAddressOrEns,e.t3=r.tokenId,e.abrupt("return",e.t0["safeTransferFrom(address,address,uint256)"].call(e.t0,e.t1,e.t2,e.t3));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gt(e,t){return ht.apply(this,arguments)}function ht(){return(ht=O(x().mark((function e(t,r){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.strict().validate(r);case 2:if(n=new o.Contract(r.tokenAddress,c.abi,t),1!==r.tokenIds.length){e.next=17;break}return e.t0=n.estimateGas,e.next=7,t.getAddress();case 7:return e.t1=e.sent,e.t2=r.daoAddressOrEns,e.t3=r.tokenIds[0],e.t4=r.amounts[0],e.t5=new Uint8Array(0),e.next=14,e.t0["safeTransferFrom(address,address,uint256,uint256,bytes)"].call(e.t0,e.t1,e.t2,e.t3,e.t4,e.t5);case 14:a=e.sent,e.next=28;break;case 17:return e.t6=n.estimateGas,e.next=20,t.getAddress();case 20:return e.t7=e.sent,e.t8=r.daoAddressOrEns,e.t9=r.tokenIds,e.t10=r.amounts,e.t11=new Uint8Array(0),e.next=27,e.t6["safeBatchTransferFrom(address,address,uint256[],uint256[],bytes)"].call(e.t6,e.t7,e.t8,e.t9,e.t10,e.t11);case 27:a=e.sent;case 28:return e.abrupt("return",a);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vt(e){var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("grant");return it(t.decodeFunctionData(a,n))}function At(e){var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("revoke");return it(t.decodeFunctionData(a,n))}function It(e){var t,n=r.PluginSetupProcessor__factory.createInterface(),a=f.bytesToHex(e),s=n.getFunction("applyUpdate");return{helpersHash:(t=n.decodeFunctionData(s,a)[1]).helpersHash,permissions:t.permissions,versionTag:t.pluginSetupRef.versionTag,pluginAddress:t.plugin,pluginRepo:t.pluginSetupRef.pluginSetupRepo,initData:f.hexToBytes(t.initData)}}function yt(e){return e.map((function(e){return{to:e.to,value:BigInt(e.value),data:f.hexToBytes(e.data)}}))}function Et(e){var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("upgradeToAndCall"),s=t.decodeFunctionData(a,n);return{implementationAddress:s[0],data:f.hexToBytes(s[1])}}function Pt(e){var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("upgradeTo");return t.decodeFunctionData(a,n)[0]}function wt(e){var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("initializeFrom"),s=t.decodeFunctionData(a,n);return{previousVersion:s[0],initData:f.hexToBytes(s[1])}}function St(e){return{id:e.id,type:e.type,creator:e.creator,dao:e.dao.id,pluginRepo:e.pluginRepo,versionTag:{build:e.pluginVersion.build,release:e.pluginVersion.release.release},pluginAddress:e.pluginAddress,permissions:e.permissions.map((function(e){return{id:e.id,operation:bt(e.operation),who:e.who,where:e.where,condition:e.condition,permissionId:e.permissionId}})),helpers:e.helpers,data:f.hexToBytes(e.data)}}function bt(e){switch(e){case fe.GRANT:return f.PermissionOperationType.GRANT;case fe.REVOKE:return f.PermissionOperationType.REVOKE;case fe.GRANT_WITH_CONDITION:return f.PermissionOperationType.GRANT_WITH_CONDITION;default:throw new f.InvalidPermissionOperationType}}function _t(e,t){return JSON.stringify(e)===JSON.stringify(t)}function xt(e,t,r){return Tt.apply(this,arguments)}function Tt(){return(Tt=O(x().mark((function e(t,r,n){var a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=pe,s={where:{plugin:r.toLowerCase(),dao:t.toLowerCase()}},e.next=5,n.request({query:a,params:s,name:"pluginInstallations"});case 5:return e.abrupt("return",e.sent.pluginInstallations);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kt(e,t,r,n){return Ot.apply(this,arguments)}function Ot(){return(Ot=O(x().mark((function e(t,r,n,a){var s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],o=vt(t.data),e.next=4,xt(n,o.where,a);case 4:return 0===e.sent.length&&s.push(exports.PluginUpdateProposalInValidityCause.PLUGIN_NOT_INSTALLED),"0"!==t.value.toString()&&s.push(exports.PluginUpdateProposalInValidityCause.NON_ZERO_GRANT_UPGRADE_PLUGIN_PERMISSION_CALL_VALUE),t.to!==n&&s.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_TO_ADDRESS),o.who!==r&&s.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_WHO_ADDRESS),o.permission!==f.Permissions.UPGRADE_PLUGIN_PERMISSION&&s.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_PERMISSION_NAME),o.permissionId!==f.PermissionIds.UPGRADE_PLUGIN_PERMISSION_ID&&s.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_UPGRADE_PLUGIN_PERMISSION_PERMISSION_ID),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e,t,r,n){return Rt.apply(this,arguments)}function Rt(){return(Rt=O(x().mark((function e(t,r,n,a){var s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],o=At(t.data),e.next=4,xt(n,o.where,a);case 4:return 0===e.sent.length&&s.push(exports.PluginUpdateProposalInValidityCause.PLUGIN_NOT_INSTALLED),t.to!==n&&s.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_TO_ADDRESS),"0"!==t.value.toString()&&s.push(exports.PluginUpdateProposalInValidityCause.NON_ZERO_REVOKE_UPGRADE_PLUGIN_PERMISSION_CALL_VALUE),o.who!==r&&s.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_WHO_ADDRESS),o.permission!==f.Permissions.UPGRADE_PLUGIN_PERMISSION&&s.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_PERMISSION_NAME),o.permissionId!==f.PermissionIds.UPGRADE_PLUGIN_PERMISSION_ID&&s.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_UPGRADE_PLUGIN_PERMISSION_PERMISSION_ID),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nt(e,t,r){var n=[],a=vt(e.data);return"0"!==e.value.toString()&&n.push(exports.PluginUpdateProposalInValidityCause.NON_ZERO_GRANT_ROOT_PERMISSION_CALL_VALUE),e.to!==t&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_ROOT_PERMISSION_TO_ADDRESS),a.where.toLowerCase()!==t&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_ROOT_PERMISSION_WHERE_ADDRESS),a.who!==r&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_ROOT_PERMISSION_WHO_ADDRESS),a.permission!==f.Permissions.ROOT_PERMISSION&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_ROOT_PERMISSION_PERMISSION_NAME),a.permissionId!==f.PermissionIds.ROOT_PERMISSION_ID&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_GRANT_ROOT_PERMISSION_PERMISSION_ID),n}function Ct(e,t,r){var n=[],a=At(e.data);return"0"!==e.value.toString()&&n.push(exports.PluginUpdateProposalInValidityCause.NON_ZERO_REVOKE_ROOT_PERMISSION_CALL_VALUE),e.to!==t&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_ROOT_PERMISSION_TO_ADDRESS),a.where!==t&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_ROOT_PERMISSION_WHERE_ADDRESS),a.who!==r&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_ROOT_PERMISSION_WHO_ADDRESS),a.permission!==f.Permissions.ROOT_PERMISSION&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_ROOT_PERMISSION_PERMISSION_NAME),a.permissionId!==f.PermissionIds.ROOT_PERMISSION_ID&&n.push(exports.PluginUpdateProposalInValidityCause.INVALID_REVOKE_ROOT_PERMISSION_PERMISSION_ID),n}function Ut(e,t,r,n){return Vt.apply(this,arguments)}function Vt(){return(Vt=O(x().mark((function e(t,r,a,s){var o,i,u,c,d,l,m,g,h,v,A,I,y,E,P,w,S;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=[],"0"!==t.value.toString()&&l.push(exports.PluginUpdateProposalInValidityCause.NON_ZERO_APPLY_UPDATE_CALL_VALUE),m=It(t.data),e.next=5,a.request({query:re,params:{address:r},name:"dao"});case 5:if(g=e.sent.dao.plugins.find((function(e){var t;return(null==(t=e.appliedPreparation)?void 0:t.pluginAddress)===m.pluginAddress.toLowerCase()}))){e.next=11;break}return l.push(exports.PluginUpdateProposalInValidityCause.PLUGIN_NOT_INSTALLED),e.abrupt("return",l);case 11:return(null==(o=g.appliedVersion)?void 0:o.release.release)!==m.versionTag.release&&l.push(exports.PluginUpdateProposalInValidityCause.UPDATE_TO_INCOMPATIBLE_RELEASE),(null==(i=g.appliedVersion)||!i.build||(null==(u=g.appliedVersion)?void 0:u.build)>=m.versionTag.build)&&l.push(exports.PluginUpdateProposalInValidityCause.UPDATE_TO_OLDER_OR_SAME_BUILD),e.next=15,a.request({query:ie,params:{id:m.pluginRepo.toLowerCase()},name:"pluginRepo"});case 15:if(h=e.sent.pluginRepo){e.next=20;break}return l.push(exports.PluginUpdateProposalInValidityCause.MISSING_PLUGIN_REPO),e.abrupt("return",l);case 20:return Te.includes(h.subdomain)||l.push(exports.PluginUpdateProposalInValidityCause.NOT_ARAGON_PLUGIN_REPO),_=xe.UPDATE,v=p.keccak256(n.defaultAbiCoder.encode(["tuple(uint8, uint16)","address","bytes32","bytes32","bytes32","uint8"],[[(b=m).versionTag.release,b.versionTag.build],b.pluginRepo,(x=b.permissions,p.keccak256(n.defaultAbiCoder.encode(["tuple(uint8,address,address,address,bytes32)[]"],[x]))),b.helpersHash,p.keccak256(new Uint8Array),_])),e.next=24,a.request({query:ce,params:{where:{preparedSetupId:v.toLowerCase(),pluginAddress:m.pluginAddress.toLowerCase()}},name:"pluginPreparations"});case 24:if(e.sent.pluginPreparations.length){e.next=29;break}return l.push(exports.PluginUpdateProposalInValidityCause.MISSING_PLUGIN_PREPARATION),e.abrupt("return",l);case 29:if(A=h.releases.find((function(e){return e.release===m.versionTag.release})),I=null==A?void 0:A.builds.find((function(e){return e.build===m.versionTag.build}))){e.next=34;break}return l.push(exports.PluginUpdateProposalInValidityCause.INVALID_PLUGIN_REPO_METADATA),e.abrupt("return",l);case 34:return y=new f.MultiUri(I.metadata).ipfsCid,e.next=38,s.fetchString(y);case 38:if(E=JSON.parse(e.sent),P=[],(P=null==E||null==(c=E.pluginSetup)||null==(c=c.prepareUpdate)||null==(c=c[null==(d=g.appliedVersion)?void 0:d.build])?void 0:c.inputs)||(P=null==E||null==(w=E.pluginSetup)||null==(w=w.prepareInstallation)||null==(w=w.prepareUpdate)||null==(w=w[null==(S=g.appliedVersion)?void 0:S.build])?void 0:w.inputs),!P){e.next=55;break}if(e.prev=44,!(m.initData.length>0&&0===P.length)){e.next=47;break}throw new Error;case 47:n.defaultAbiCoder.decode(f.getNamedTypesFromMetadata(P),m.initData),e.next=53;break;case 50:e.prev=50,e.t0=e.catch(44),l.push(exports.PluginUpdateProposalInValidityCause.INVALID_DATA);case 53:e.next=56;break;case 55:l.push(exports.PluginUpdateProposalInValidityCause.INVALID_PLUGIN_REPO_METADATA);case 56:return e.abrupt("return",l);case 57:case"end":return e.stop()}var b,_,x}),e,null,[[44,50]])})))).apply(this,arguments)}function Lt(e){for(var t,r=[],n=V(e);!(t=n()).done;){var a=t.value;try{switch(f.getFunctionFragment(a.data,ke).name){case"upgradeTo":r.push(me.UPGRADE_TO);break;case"upgradeToAndCall":r.push(me.UPGRADE_TO_AND_CALL);break;case"grant":switch(vt(a.data).permission){case f.Permissions.UPGRADE_PLUGIN_PERMISSION:r.push(me.GRANT_PLUGIN_UPGRADE_PERMISSION);break;case f.Permissions.ROOT_PERMISSION:r.push(me.GRANT_ROOT_PERMISSION);break;default:r.push(me.UNKNOWN)}break;case"revoke":switch(At(a.data).permission){case f.Permissions.UPGRADE_PLUGIN_PERMISSION:r.push(me.REVOKE_PLUGIN_UPGRADE_PERMISSION);break;case f.Permissions.ROOT_PERMISSION:r.push(me.REVOKE_ROOT_PERMISSION);break;default:r.push(me.UNKNOWN)}break;case"applyUpdate":r.push(me.APPLY_UPDATE);break;default:r.push(me.ACTION_NOT_ALLOWED)}}catch(e){r.push(me.UNKNOWN)}}return r}function Bt(e){var t=e.slice(0,5);return 5===t.length&&_t(t,De)}function Mt(e){var t=e.slice(0,3);return 3===t.length&&_t(t,Oe)}function Gt(e){return e[0]===me.UPGRADE_TO||e[0]===me.UPGRADE_TO_AND_CALL}function qt(e,t,r,n){var a=Lt(e),s=[],o=[];if(!Gt(a))return{isValid:!1,proposalSettingsErrorCauses:[exports.ProposalSettingsErrorCause.INVALID_ACTIONS],actionErrorCauses:[]};var i=a[0],u=e[0];switch(u.to!==t&&s.push(exports.DaoUpdateProposalInvalidityCause.INVALID_TO_ADDRESS),"0"!==u.value.toString()&&s.push(exports.DaoUpdateProposalInvalidityCause.NON_ZERO_CALL_VALUE),i){case me.UPGRADE_TO:r!==Pt(e[0].data)&&s.push(exports.DaoUpdateProposalInvalidityCause.INVALID_UPGRADE_TO_IMPLEMENTATION_ADDRESS);break;case me.UPGRADE_TO_AND_CALL:var c=Et(e[0].data),d=wt(c.data);r!==c.implementationAddress&&s.push(exports.DaoUpdateProposalInvalidityCause.INVALID_UPGRADE_TO_AND_CALL_IMPLEMENTATION_ADDRESS),JSON.stringify(d.previousVersion)!==JSON.stringify(n)&&s.push(exports.DaoUpdateProposalInvalidityCause.INVALID_UPGRADE_TO_AND_CALL_VERSION),0!==d.initData.length&&s.push(exports.DaoUpdateProposalInvalidityCause.INVALID_UPGRADE_TO_AND_CALL_DATA);break;default:o.push(exports.ProposalSettingsErrorCause.INVALID_ACTIONS)}return{isValid:0===s.length&&0===o.length,actionErrorCauses:s,proposalSettingsErrorCauses:o}}function Ft(e,t,r,n,a){return $t.apply(this,arguments)}function $t(){return($t=O(x().mark((function e(t,r,n,a,s){var o,i,u,c,d,p,l,f,m,g,h,v,A,I;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=[],u=[],!Mt(c=Lt(t))){e.next=36;break}o[0]=[],d=V(c.slice(0,3).entries());case 6:if((p=d()).done){e.next=28;break}f=(l=p.value)[0],e.t0=l[1],e.next=e.t0===me.GRANT_PLUGIN_UPGRADE_PERMISSION?11:e.t0===me.REVOKE_PLUGIN_UPGRADE_PERMISSION?16:e.t0===me.APPLY_UPDATE?21:26;break;case 11:return e.next=13,kt(t[f],n,r,a);case 13:return o[0]=[].concat(o[0],i=e.sent),e.abrupt("break",26);case 16:return e.next=18,Dt(t[f],n,r,a);case 18:return o[0]=[].concat(o[0],i=e.sent),e.abrupt("break",26);case 21:return e.next=23,Ut(t[f],r,a,s);case 23:return o[0]=[].concat(o[0],i=e.sent),e.abrupt("break",26);case 26:e.next=6;break;case 28:if(0===(t=t.slice(3)).length){e.next=35;break}return e.next=32,Ft(t,r,n,a,s);case 32:o=[].concat(o,(m=e.sent).actionErrorCauses),u=[].concat(u,m.proposalSettingsErrorCauses);case 35:return e.abrupt("return",{isValid:o.every((function(e){return 0===e.length}))&&0===u.length,actionErrorCauses:o,proposalSettingsErrorCauses:u});case 36:if(!Bt(c)){e.next=75;break}o[0]=[],g=V(c.slice(0,5).entries());case 39:if((h=g()).done){e.next=67;break}A=(v=h.value)[0],e.t1=v[1],e.next=e.t1===me.GRANT_PLUGIN_UPGRADE_PERMISSION?44:e.t1===me.REVOKE_PLUGIN_UPGRADE_PERMISSION?49:e.t1===me.GRANT_ROOT_PERMISSION?54:e.t1===me.REVOKE_ROOT_PERMISSION?57:e.t1===me.APPLY_UPDATE?60:65;break;case 44:return e.next=46,kt(t[A],n,r,a);case 46:return o[0]=[].concat(o[0],i=e.sent),e.abrupt("break",65);case 49:return e.next=51,Dt(t[A],n,r,a);case 51:return o[0]=[].concat(o[0],i=e.sent),e.abrupt("break",65);case 54:return i=Nt(t[A],r,n),o[0]=[].concat(o[0],i),e.abrupt("break",65);case 57:return i=Ct(t[A],r,n),o[0]=[].concat(o[0],i),e.abrupt("break",65);case 60:return e.next=62,Ut(t[A],r,a,s);case 62:return o[0]=[].concat(o[0],i=e.sent),e.abrupt("break",65);case 65:e.next=39;break;case 67:if(0===(t=t.slice(5)).length){e.next=74;break}return e.next=71,Ft(t,r,n,a,s);case 71:o=[].concat(o,(I=e.sent).actionErrorCauses),u=[].concat(u,I.proposalSettingsErrorCauses);case 74:return e.abrupt("return",{isValid:o.every((function(e){return 0===e.length}))&&0===u.length,actionErrorCauses:o,proposalSettingsErrorCauses:u});case 75:return e.abrupt("return",{isValid:!1,proposalSettingsErrorCauses:[exports.ProposalSettingsErrorCause.INVALID_ACTIONS],actionErrorCauses:o});case 76:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ht,Wt,jt,Kt=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var d=t.prototype;return d.prepareInstallation=function(e){var t=this;return T(x().mark((function r(){return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,_(f.PrepareInstallationSchema.strict().validate(e));case 2:return r.delegateYield(w(S(f.prepareGenericInstallation(t.web3,D({},e,{pluginSetupProcessorAddress:t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)})))),"t0",3);case 3:case"end":return r.stop()}}),r)})))()},d.createDao=function(e){var t=this;return T(x().mark((function n(){var a,o,i,u,c,d,p,m,g,A,I,y,E,P,w,S,b,T,k,O,D,R,N,C,U,L;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,_(Re.strict().validate(e));case 2:d=t.web3.getConnectedSigner(),p=r.DAOFactory__factory.connect(t.web3.getAddress(v.FrameworkContractsNames.DAO_FACTORY),d),m=[],g=V(e.plugins);case 6:if((A=g()).done){n.next=18;break}return y=r.PluginRepo__factory.connect((I=A.value).id,d),n.next=11,_(y.latestRelease());case 11:return E=n.sent,n.next=14,_(y["getLatestVersion(uint8)"](E));case 14:m.push({pluginSetupRef:{pluginSetupRepo:y.address,versionTag:n.sent.tag},data:I.data});case 16:n.next=6;break;case 18:return n.next=20,_(p.pluginSetupProcessor());case 20:return P=r.PluginSetupProcessor__factory.connect(n.sent,d),w=!1,n.next=25,_(p.daoBase());case 25:S=n.sent,b=0,T=m;case 27:if(!(b<T.length)){n.next=39;break}return k=T[b],n.next=31,_(P.callStatic.prepareInstallation(S,k));case 31:if(!n.sent[1].permissions.find((function(e){return e.permissionId===f.PermissionIds.EXECUTE_PERMISSION_ID}))){n.next=36;break}return w=!0,n.abrupt("break",39);case 36:b++,n.next=27;break;case 39:if(w){n.next=41;break}throw new f.MissingExecPermissionError;case 41:return n.next=43,_(p.connect(d).createDao({subdomain:null!=(a=e.ensSubdomain)?a:"",metadata:l.toUtf8Bytes(e.metadataUri),daoURI:null!=(o=e.daoUri)?o:"",trustedForwarder:null!=(i=e.trustedForwarder)?i:s.AddressZero},m));case 43:return O=n.sent,n.next=46,{key:exports.DaoCreationSteps.CREATING,txHash:O.hash};case 46:return n.next=48,_(O.wait());case 48:if(D=n.sent,R=r.DAORegistry__factory.createInterface(),N=null==(u=D.logs)?void 0:u.find((function(e){return e.topics[0]===h.id(R.getEvent("DAORegistered").format("sighash"))}))){n.next=53;break}throw new f.DaoCreationError;case 53:if(C=r.PluginSetupProcessor__factory.createInterface(),U=null==(c=D.logs)?void 0:c.filter((function(e){return e.topics[0]===h.id(C.getEvent("InstallationApplied").format("sighash"))})),(L=R.parseLog(N)).args.dao){n.next=58;break}throw new f.DaoCreationError;case 58:return n.next=60,{key:exports.DaoCreationSteps.DONE,address:L.args.dao,pluginAddresses:U.map((function(e){return C.parseLog(e).args[1]}))};case 60:case"end":return n.stop()}}),n)})))()},d.pinMetadata=function(){var e=O(x().mark((function e(t){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne.strict().validate(t);case 2:return e.prev=2,e.next=5,this.ipfs.add(JSON.stringify(t));case 5:return r=e.sent,e.next=8,this.ipfs.pin(r);case 8:return e.abrupt("return","ipfs://"+r);case 11:throw e.prev=11,e.t0=e.catch(2),new f.IpfsPinError(e.t0);case 14:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t){return e.apply(this,arguments)}}(),d.deposit=function(e){var t=this;return T(x().mark((function r(){return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e.type,r.next=r.t0===f.TokenType.NATIVE?3:r.t0===f.TokenType.ERC20?5:r.t0===f.TokenType.ERC721?7:r.t0===f.TokenType.ERC1155?9:11;break;case 3:return r.delegateYield(w(S(t.depositNative(e))),"t1",4);case 4:case 6:case 8:case 10:return r.abrupt("break",12);case 5:return r.delegateYield(w(S(t.depositErc20(e))),"t2",6);case 7:return r.delegateYield(w(S(t.depositErc721(e))),"t3",8);case 9:return r.delegateYield(w(S(t.depositErc1155(e))),"t4",10);case 11:throw new f.NotImplementedError("Token type not valid, use transfer function instead");case 12:case"end":return r.stop()}}),r)})))()},d.depositNative=function(e){var t=this;return T(x().mark((function n(){var a,o,i,u,c,d,p,l;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,_(Ce.strict().validate(e));case 2:return a=t.web3.getConnectedSigner(),o=e.amount,i={value:e.amount},u=r.DAO__factory.connect(e.daoAddressOrEns,a),n.next=8,_(u.deposit(s.AddressZero,o,"",i));case 8:return c=n.sent,n.next=11,{key:exports.DaoDepositSteps.DEPOSITING,txHash:c.hash};case 11:return n.next=13,_(c.wait());case 13:if(d=f.findLog(n.sent,u.interface,"Deposited")){n.next=17;break}throw new f.FailedDepositError;case 17:if(p=r.DAO__factory.createInterface(),l=p.parseLog(d),!o.toString()!==l.args.amount){n.next=21;break}throw new f.AmountMismatchError(o,l.args.amount.toBigInt());case 21:return n.next=23,{key:exports.DaoDepositSteps.DONE,amount:o};case 23:case"end":return n.stop()}}),n)})))()},d.depositErc20=function(e){var t=this;return T(x().mark((function n(){var a,s,u,c,d,p,l,m,g,h,v;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,_(Ue.strict().validate(e));case 2:return a=t.web3.getConnectedSigner(),u=e.daoAddressOrEns,c=e.amount,d=new o.Contract(s=e.tokenAddress,i.abi,a),n.t0=_,n.t1=d,n.next=9,_(a.getAddress());case 9:return n.t2=n.sent,n.t3=u,n.t4=n.t1.allowance.call(n.t1,n.t2,n.t3),n.next=14,(0,n.t0)(n.t4);case 14:return p=n.sent,n.next=17,{key:exports.DaoDepositSteps.CHECKED_ALLOWANCE,allowance:p.toBigInt()};case 17:if(!p.lt(e.amount)){n.next=19;break}return n.delegateYield(w(S(t.setAllowance({amount:e.amount,spender:e.daoAddressOrEns,tokenAddress:e.tokenAddress}))),"t5",19);case 19:return l=r.DAO__factory.connect(u,a),n.next=22,_(l.deposit(s,c,""));case 22:return m=n.sent,n.next=25,{key:exports.DaoDepositSteps.DEPOSITING,txHash:m.hash};case 25:return n.next=27,_(m.wait());case 27:if(g=f.findLog(n.sent,l.interface,"Deposited")){n.next=31;break}throw new f.FailedDepositError;case 31:if(h=r.DAO__factory.createInterface(),v=h.parseLog(g),!c.toString()!==v.args.amount){n.next=35;break}throw new f.AmountMismatchError(c,v.args.amount.toBigInt());case 35:return n.next=37,{key:exports.DaoDepositSteps.DONE,amount:c};case 37:case"end":return n.stop()}}),n)})))()},d.depositErc721=function(e){var t=this;return T(x().mark((function r(){var n,a,s,i,c;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,_(Ve.strict().validate(e));case 2:return n=t.web3.getConnectedSigner(),a=new o.Contract(e.tokenAddress,u.abi,n),r.t0=_,r.t1=a,r.next=8,_(n.getAddress());case 8:return r.t2=r.sent,r.t3=e.daoAddressOrEns,r.t4=e.tokenId,r.t5=r.t1["safeTransferFrom(address,address,uint256)"].call(r.t1,r.t2,r.t3,r.t4),r.next=14,(0,r.t0)(r.t5);case 14:return s=r.sent,r.next=17,_(s.wait());case 17:if(i=f.findLog(r.sent,a.interface,"Transfer")){r.next=21;break}throw new f.FailedDepositError;case 21:if((c=a.interface.parseLog(i)).args.tokenId&&c.args.tokenId.toString()===e.tokenId.toString()){r.next=24;break}throw new f.FailedDepositError;case 24:return r.next=26,{key:exports.DaoDepositSteps.DONE,tokenId:e.tokenId};case 26:case"end":return r.stop()}}),r)})))()},d.depositErc1155=function(e){var t=this;return T(x().mark((function r(){var n,a,s,i,u,d,p;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,_(Le.strict().validate(e));case 2:if(n=t.web3.getConnectedSigner(),a=new o.Contract(e.tokenAddress,c.abi,n),1!==e.tokenIds.length){r.next=22;break}return r.t0=_,r.t1=a,r.next=9,_(n.getAddress());case 9:return r.t2=r.sent,r.t3=e.daoAddressOrEns,r.t4=e.tokenIds[0],r.t5=e.amounts[0],r.t6=new Uint8Array([]),r.t7=r.t1["safeTransferFrom(address,address,uint256,uint256,bytes)"].call(r.t1,r.t2,r.t3,r.t4,r.t5,r.t6),r.next=17,(0,r.t0)(r.t7);case 17:s=r.sent,i="TransferSingle",u="id",r.next=37;break;case 22:return r.t8=_,r.t9=a,r.next=26,_(n.getAddress());case 26:return r.t10=r.sent,r.t11=e.daoAddressOrEns,r.t12=e.tokenIds,r.t13=e.amounts,r.t14=new Uint8Array([]),r.t15=r.t9["safeBatchTransferFrom(address,address,uint256[],uint256[],bytes)"].call(r.t9,r.t10,r.t11,r.t12,r.t13,r.t14),r.next=34,(0,r.t8)(r.t15);case 34:s=r.sent,i="TransferBatch",u="ids";case 37:return r.next=39,_(s.wait());case 39:if(d=f.findLog(r.sent,a.interface,i)){r.next=43;break}throw new f.FailedDepositError;case 43:if((p=a.interface.parseLog(d)).args[u]&&p.args[u].toString()===e.tokenIds.toString()){r.next=46;break}throw new f.FailedDepositError;case 46:return r.next=48,{key:exports.DaoDepositSteps.DONE,tokenIds:e.tokenIds,amounts:e.amounts};case 48:case"end":return r.stop()}}),r)})))()},d.setAllowance=function(e){var t=this;return T(x().mark((function r(){var n,s,u,c,d;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.web3.getConnectedSigner(),s=new o.Contract(e.tokenAddress,i.abi,n),r.next=4,_(s.approve(e.spender,e.amount));case 4:return u=r.sent,r.next=7,{key:exports.SetAllowanceSteps.SETTING_ALLOWANCE,txHash:u.hash};case 7:return r.next=9,_(u.wait());case 9:if(c=f.findLog(r.sent,s.interface,"Approval")){r.next=13;break}throw new f.UpdateAllowanceError;case 13:if((d=c.data)&&!a.BigNumber.from(e.amount).gt(a.BigNumber.from(d))){r.next=16;break}throw new f.UpdateAllowanceError;case 16:return r.next=18,{key:exports.SetAllowanceSteps.ALLOWANCE_SET,allowance:e.amount};case 18:case"end":return r.stop()}}),r)})))()},d.prepareUninstallation=function(e){var t=this;return T(x().mark((function a(){var s,o,i,u,c,d,p,l,m,g,h;return x().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,_(f.PrepareUninstallationSchema.strict().validate(e));case 2:return s=t.web3.getConnectedSigner(),a.next=5,_(t.graphql.request({query:ue,params:{address:e.pluginAddress.toLowerCase(),where:{dao:e.daoAddressOrEns.toLowerCase()}},name:"plugin"}));case 5:if(i=a.sent.iplugin.installations[void 0===(o=e.pluginInstallationIndex)?0:o]){a.next=11;break}throw new f.InstallationNotFoundError;case 11:return d=n.defaultAbiCoder.encode(void 0===(c=e.uninstallationAbi)?[]:c,void 0===(u=e.uninstallationParams)?[]:u),p=r.PluginSetupProcessor__factory.connect(t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR),s),a.next=16,_(p.prepareUninstallation(e.daoAddressOrEns,{pluginSetupRef:{pluginSetupRepo:i.appliedPreparation.pluginRepo.id,versionTag:{build:i.appliedVersion.build,release:i.appliedVersion.release.release}},setupPayload:{plugin:e.pluginAddress,currentHelpers:i.appliedPreparation.helpers,data:d}}));case 16:return l=a.sent,a.next=19,{key:f.PrepareUninstallationSteps.PREPARING,txHash:l.hash};case 19:return a.next=21,_(l.wait());case 21:if(m=f.findLog(a.sent,p.interface,"UninstallationPrepared")){a.next=25;break}throw new f.PluginUninstallationPreparationError;case 25:if(g=p.interface.parseLog(m),h=g.args.permissions){a.next=29;break}throw new f.PluginUninstallationPreparationError;case 29:return a.next=31,{key:f.PrepareUninstallationSteps.DONE,permissions:h.map((function(e){return{operation:e.operation,where:e.where,who:e.who,permissionId:e.permissionId}})),pluginRepo:i.appliedPreparation.pluginRepo.id,pluginAddress:e.pluginAddress,versionTag:{build:i.appliedVersion.build,release:i.appliedVersion.release.release}};case 31:case"end":return a.stop()}}),a)})))()},d.prepareUpdate=function(e){var t=this;return T(x().mark((function r(){return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(w(S(f.prepareGenericUpdate(t.web3,t.graphql,D({},e,{pluginSetupProcessorAddress:t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)})))),"t0",1);case 1:case"end":return r.stop()}}),r)})))()},d.hasPermission=function(){var e=O(x().mark((function e(t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Me.strict().validate(t);case 2:return n=this.web3.getProvider(),a=r.DAO__factory.connect(t.daoAddressOrEns,n),e.abrupt("return",a.hasPermission(t.where,t.who,h.id(t.permission),t.data||new Uint8Array([])));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.getDao=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.AddressOrEnsSchema.strict().validate(t);case 2:if(r=t.toLowerCase(),g.isAddress(r)){e.next=21;break}return e.next=6,this.web3.ensureOnline();case 6:if(n=this.web3.getProvider()){e.next=9;break}throw new f.NoProviderError;case 9:return e.prev=9,e.next=12,n.resolveName(r);case 12:if(a=e.sent){e.next=15;break}throw new f.InvalidAddressOrEnsError;case 15:r=a.toLowerCase(),e.next=21;break;case 18:throw e.prev=18,e.t0=e.catch(9),new f.InvalidAddressOrEnsError(e.t0);case 21:return s=re,o={address:r},e.next=26,this.graphql.request({query:s,params:o,name:"DAO"});case 26:if(i=e.sent.dao){e.next=32;break}return e.abrupt("return",null);case 32:if(i.metadata){e.next=34;break}return e.abrupt("return",et(i,Ie));case 34:return e.prev=34,u=f.resolveIpfsCid(i.metadata),e.next=38,this.ipfs.fetchString(u);case 38:return c=JSON.parse(e.sent),e.abrupt("return",et(i,c));case 43:if(e.prev=43,e.t1=e.catch(34),!(e.t1 instanceof f.InvalidCidError)){e.next=47;break}return e.abrupt("return",et(i,Ae));case 47:return e.abrupt("return",et(i,ye));case 48:case"end":return e.stop()}}),e,this,[[9,18],[34,43]])})));return function(t){return e.apply(this,arguments)}}(),d.getDaos=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===(r=t.limit)?10:r,s=void 0===(a=t.skip)?0:a,i=void 0===(o=t.direction)?f.SortDirection.ASC:o,c=void 0===(u=t.sortBy)?exports.DaoSortBy.CREATED_AT:u,e.next=3,Ge.strict().validate({limit:n,skip:s,direction:i,sortBy:c});case 3:return d=ne,p={limit:n,skip:s,direction:i,sortBy:c},e.next=8,this.graphql.request({query:d,params:p,name:"DAOs"});case 8:return e.abrupt("return",Promise.all(e.sent.daos.map(function(){var e=O(x().mark((function e(t){var r,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.metadata){e.next=2;break}return e.abrupt("return",tt(t,Ie));case 2:return e.prev=2,r=f.resolveIpfsCid(t.metadata),e.next=6,f.promiseWithTimeout(l.ipfs.fetchString(r),f.MULTI_FETCH_TIMEOUT);case 6:return n=JSON.parse(e.sent),e.abrupt("return",tt(t,n));case 11:if(e.prev=11,e.t0=e.catch(2),!(e.t0 instanceof f.InvalidCidError)){e.next=15;break}return e.abrupt("return",tt(t,Ae));case 15:return e.abrupt("return",tt(t,ye));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.getDaoBalances=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m,h,v,A,I;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.daoAddressOrEns,a=void 0===(n=t.limit)?10:n,o=void 0===(s=t.skip)?0:s,u=void 0===(i=t.direction)?f.SortDirection.ASC:i,d=void 0===(c=t.sortBy)?exports.AssetBalanceSortBy.LAST_UPDATED:c,e.next=3,qe.strict().validate({daoAddressOrEns:r,limit:a,skip:o,direction:u,sortBy:d});case 3:if(p={},!(l=r)){e.next=19;break}if(g.isAddress(l)){e.next=18;break}return e.next=9,this.web3.ensureOnline();case 9:if(m=this.web3.getProvider()){e.next=12;break}throw new f.NoProviderError;case 12:return e.next=14,m.resolveName(l);case 14:if(h=e.sent){e.next=17;break}throw new f.InvalidAddressOrEnsError;case 17:l=h;case 18:p={dao:l.toLowerCase()};case 19:return v=ae,A={where:p,limit:a,skip:o,direction:u,sortBy:d},e.next=24,this.graphql.request({query:v,params:A,name:"dao balances"});case 24:if(0!==(I=e.sent.tokenBalances).length){e.next=28;break}return e.abrupt("return",[]);case 28:return e.abrupt("return",I.map((function(e){return rt(e)})));case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.getDaoTransfers=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m,h,v,A,I;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.type,a=void 0===(n=t.limit)?10:n,o=void 0===(s=t.skip)?0:s,u=void 0===(i=t.direction)?f.SortDirection.ASC:i,d=void 0===(c=t.sortBy)?exports.TransferSortBy.CREATED_AT:c,p={},!(l=t.daoAddressOrEns)){e.next=23;break}if(g.isAddress(l)){e.next=22;break}return e.next=7,this.web3.ensureOnline();case 7:if(m=this.web3.getProvider()){e.next=10;break}throw new f.NoProviderError;case 10:return e.prev=10,e.next=13,m.resolveName(l);case 13:if(h=e.sent){e.next=16;break}throw new f.InvalidAddressOrEnsError;case 16:l=h,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new f.InvalidAddressOrEnsError(e.t0);case 22:p={dao:l.toLowerCase()};case 23:return r&&(p=D({},p,{type:ge.get(r)})),v=se,A={where:p,limit:a,skip:o,direction:u,sortBy:d},e.next=29,this.graphql.request({query:v,params:A,name:"dao transfers"});case 29:if(I=e.sent.tokenTransfers){e.next=33;break}return e.abrupt("return",null);case 33:return e.abrupt("return",I.map((function(e){return nt(e)})));case 34:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),d.getMetadata=function(){var e=O(x().mark((function e(t){var r,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.resolveIpfsCid(t),e.next=3,this.ipfs.fetchString(r);case 3:return n=JSON.parse(e.sent),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.getPluginRepo=function(){var e=O(x().mark((function e(t,r){var n,a,s,o,i,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",at(t,Pe,be));case 2:return o=null==t||null==(n=t.releases[0])?void 0:n.metadata,e.prev=3,e.next=6,this.getMetadata(o);case 6:s=e.sent,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),s=we,e.t0 instanceof f.InvalidCidError?s=Ee:e.t0 instanceof f.EmptyMultiUriError&&(s=Pe);case 13:return u=null==t||null==(a=t.releases[0])||null==(a=a.builds[0])?void 0:a.metadata,e.prev=14,e.next=17,this.getMetadata(u);case 17:i=e.sent,e.next=24;break;case 20:e.prev=20,e.t1=e.catch(14),i=_e,e.t1 instanceof f.InvalidCidError?i=Se:e.t1 instanceof f.EmptyMultiUriError&&(i=be);case 24:return e.abrupt("return",at(t,s,i));case 25:case"end":return e.stop()}}),e,this,[[3,9],[14,20]])})));return function(t,r){return e.apply(this,arguments)}}(),d.getPlugins=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m,g,h,v,A=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=void 0===(n=(r=void 0===t?{}:t).limit)?10:n,o=void 0===(s=r.skip)?0:s,u=void 0===(i=r.direction)?f.SortDirection.ASC:i,d=void 0===(c=r.sortBy)?exports.PluginSortBy.SUBDOMAIN:c,p=r.subdomain,m=void 0===(l=r.includeMetadata)||l,e.next=3,Fe.strict().validate({limit:a,skip:o,direction:u,sortBy:d,subdomain:p});case 3:return g={},p&&(g={subdomain_contains_nocase:p}),h=oe,v={where:g,limit:a,skip:o,direction:u,sortBy:d},e.next=10,this.graphql.request({query:h,params:v,name:"plugin repos"});case 10:return e.abrupt("return",Promise.all(e.sent.pluginRepos.map((function(e){return A.getPluginRepo(e,m)}))));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.getPlugin=function(){var e=O(x().mark((function e(t,r){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=!0),e.next=3,f.AddressOrEnsSchema.strict().validate(t);case 3:return n=ie,e.next=7,this.graphql.request({query:n,params:{id:t.toLowerCase()},name:"plugin version"});case 7:return e.abrupt("return",this.getPluginRepo(e.sent.pluginRepo,r));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),d.getProtocolVersion=function(){var e=O(x().mark((function e(t){var n,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.AddressOrEnsSchema.strict().validate(t);case 2:return n=this.web3.getProvider(),a=r.IProtocolVersion__factory.connect(t,n),e.prev=4,e.next=7,a.protocolVersion();case 7:s=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),s=[1,0,0];case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}(),d.isDaoUpdateProposal=function(){var e=O(x().mark((function e(t){var r,n,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=le,e.next=4,this.graphql.request({query:r,params:{id:f.getExtendedProposalId(t.toLowerCase())},name:"iproposal"});case 4:if(n=e.sent.iproposal){e.next=8;break}return e.abrupt("return",!1);case 8:return a=yt(n.actions),s=Lt(a),e.abrupt("return",s.includes(me.UPGRADE_TO_AND_CALL)||s.includes(me.UPGRADE_TO));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.isPluginUpdateProposal=function(){var e=O(x().mark((function e(t){var r,n,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=le,e.next=4,this.graphql.request({query:r,params:{id:f.getExtendedProposalId(t.toLowerCase())},name:"iproposal"});case 4:if(n=e.sent.iproposal){e.next=8;break}return e.abrupt("return",!1);case 8:return a=yt(n.actions),s=Lt(a),e.abrupt("return",s.includes(me.APPLY_UPDATE));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.isPluginUpdateProposalValid=function(){var e=O(x().mark((function e(t){var r,n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=le,e.next=4,this.graphql.request({query:r,params:{id:f.getExtendedProposalId(t.toLowerCase())},name:"iproposal"});case 4:if(n=e.sent.iproposal){e.next=8;break}return e.abrupt("return",{isValid:!1,actionErrorCauses:[],proposalSettingsErrorCauses:[exports.ProposalSettingsErrorCause.PROPOSAL_NOT_FOUND]});case 8:if("0"===n.allowFailureMap){e.next=10;break}return e.abrupt("return",{isValid:!1,actionErrorCauses:[],proposalSettingsErrorCauses:[exports.ProposalSettingsErrorCause.NON_ZERO_ALLOW_FAILURE_MAP_VALUE]});case 10:return Gt(Lt(a=yt(n.actions)))&&(a=a.slice(1)),e.abrupt("return",Ft(a,n.dao.id,this.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR),this.graphql,this.ipfs));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.isDaoUpdateProposalValid=function(){var e=O(x().mark((function e(t,r){var n,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=le,e.next=4,this.graphql.request({query:n,params:{id:f.getExtendedProposalId(t.toLowerCase())},name:"iproposal"});case 4:if(a=e.sent.iproposal){e.next=8;break}return e.abrupt("return",{isValid:!1,proposalSettingsErrorCauses:[exports.ProposalSettingsErrorCause.PROPOSAL_NOT_FOUND],actionErrorCauses:[]});case 8:if("0"===a.allowFailureMap){e.next=10;break}return e.abrupt("return",{isValid:!1,actionErrorCauses:[],proposalSettingsErrorCauses:[exports.ProposalSettingsErrorCause.NON_ZERO_ALLOW_FAILURE_MAP_VALUE]});case 10:return s=this.web3.getAddress(v.FrameworkContractsNames.DAO_FACTORY),r&&(s=v.contracts[this.web3.getNetworkName()][r].DAOFactory.address),e.t0=qt,e.t1=yt(a.actions),e.t2=a.dao.id,e.next=17,this.getDaoImplementation(s);case 17:return e.t3=e.sent,e.next=20,this.getProtocolVersion(a.dao.id);case 20:return e.t4=e.sent,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),d.getDaoImplementation=function(){var e=O(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.DAOFactory__factory.connect(t,this.web3.getProvider()),e.abrupt("return",n.daoBase());case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),d.getPluginPreparations=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m,g,h,v;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.type,n=t.pluginAddress,a=t.pluginRepoAddress,s=t.daoAddressOrEns,i=void 0===(o=t.limit)?10:o,c=void 0===(u=t.skip)?0:u,p=void 0===(d=t.direction)?f.SortDirection.ASC:d,m=void 0===(l=t.sortBy)?exports.PluginPreparationSortBy.ID:l,e.next=3,Qe.strict().validate({type:r,pluginAddress:n,pluginRepoAddress:a,daoAddressOrEns:s,limit:i,skip:c,direction:p,sortBy:m});case 3:return g={},r&&(g=D({},g,{type:r})),n&&(g=D({},g,{pluginAddress:n.toLowerCase()})),a&&(g=D({},g,{pluginRepo:a.toLowerCase()})),s&&(g=D({},g,{dao:s.toLowerCase()})),h=de,v={where:g,limit:i,skip:c,direction:p,sortBy:m},e.next=13,this.graphql.request({query:h,params:v,name:"plugin preparations"});case 13:return e.abrupt("return",Promise.all(e.sent.pluginPreparations.map((function(e){return St(e)}))));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(f.ClientCore),Yt=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var a=t.prototype;return a.applyInstallationAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),f.ApplyInstallationSchema.strict().validateSync(t);var a=r.PluginSetupProcessor__factory.createInterface(),o=function(e){return{plugin:e.pluginAddress,pluginSetupRef:{pluginSetupRepo:e.pluginRepo,versionTag:e.versionTag},helpersHash:p.keccak256(n.defaultAbiCoder.encode(["address[]"],[e.helpers])),permissions:e.permissions.map((function(e){return D({},e,{condition:e.condition||s.AddressZero})}))}}(t),i=a.encodeFunctionData("applyInstallation",[e,o]),u=this.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR),c=this.grantAction(e,{where:e,who:u,permission:f.Permissions.ROOT_PERMISSION}),d=this.revokeAction(e,{where:e,who:u,permission:f.Permissions.ROOT_PERMISSION});return[c,{to:u,value:BigInt(0),data:f.hexToBytes(i)},d]},a.applyUninstallationAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),f.ApplyUninstallationSchema.strict().validateSync(t);var n=r.PluginSetupProcessor__factory.createInterface(),a=function(e){return{plugin:e.pluginAddress,pluginSetupRef:{pluginSetupRepo:e.pluginRepo,versionTag:e.versionTag},permissions:e.permissions.map((function(e){return D({},e,{condition:e.condition||s.AddressZero})}))}}(t),o=n.encodeFunctionData("applyUninstallation",[e,a]),i=this.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR),u=this.grantAction(e,{where:e,who:i,permission:f.Permissions.ROOT_PERMISSION}),c=this.revokeAction(e,{where:e,who:i,permission:f.Permissions.ROOT_PERMISSION});return[u,{to:i,value:BigInt(0),data:f.hexToBytes(o)},c]},a.applyUpdateAndPermissionsActionBlock=function(e,t){var a=r.PluginSetupProcessor__factory.createInterface(),o=function(e){return{plugin:e.pluginAddress,pluginSetupRef:{pluginSetupRepo:e.pluginRepo,versionTag:e.versionTag},initData:e.initData,helpersHash:p.keccak256(n.defaultAbiCoder.encode(["address[]"],[e.helpers])),permissions:e.permissions.map((function(e){return D({},e,{condition:e.condition||s.AddressZero})}))}}(t),i=a.encodeFunctionData("applyUpdate",[e,o]),u=this.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR),c=this.grantAction(e,{where:t.pluginAddress,who:u,permission:f.Permissions.UPGRADE_PLUGIN_PERMISSION}),d=this.revokeAction(e,{where:t.pluginAddress,who:u,permission:f.Permissions.UPGRADE_PLUGIN_PERMISSION});if(t.permissions.length>0){var l=this.grantAction(e,{where:e,who:u,permission:f.Permissions.ROOT_PERMISSION}),m=this.revokeAction(e,{where:e,who:u,permission:f.Permissions.ROOT_PERMISSION});return[c,l,{to:u,value:BigInt(0),data:f.hexToBytes(i)},m,d]}return[c,{to:u,value:BigInt(0),data:f.hexToBytes(i)},d]},a.grantAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),$e.strict().validateSync(t);var n=t.where,a=t.who;if(!g.isAddress(n)||!g.isAddress(a)||!g.isAddress(e))throw new f.InvalidAddressError;var s=r.DAO__factory.createInterface(),o=ot({who:a,where:n,permission:t.permission}),i=s.encodeFunctionData("grant",o);return{to:e,value:BigInt(0),data:f.hexToBytes(i)}},a.grantWithConditionAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),He.strict().validateSync(t);var n=t.where,a=t.who;if(!g.isAddress(n)||!g.isAddress(a)||!g.isAddress(e))throw new f.InvalidAddressError;var s=r.DAO__factory.createInterface(),o=function(e){return[].concat(ot({who:e.who,where:e.where,permission:e.permission}),[e.condition])}({who:a,where:n,permission:t.permission,condition:t.condition}),i=s.encodeFunctionData("grantWithCondition",o);return{to:e,value:BigInt(0),data:f.hexToBytes(i)}},a.revokeAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),$e.strict().validateSync(t);var n=t.where,a=t.who;if(!g.isAddress(n)||!g.isAddress(a)||!g.isAddress(e))throw new f.InvalidAddressError;var s=r.DAO__factory.createInterface(),o=ot({who:a,where:n,permission:t.permission}),i=s.encodeFunctionData("revoke",o);return{to:e,value:BigInt(0),data:f.hexToBytes(i)}},a.withdrawAction=function(){var e=O(x().mark((function e(t){var r,n,a,s,d;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.recipientAddressOrEns,g.isAddress(t.recipientAddressOrEns)){e.next=8;break}return e.next=4,null==(n=this.web3.getSigner())?void 0:n.resolveName(t.recipientAddressOrEns);case 4:if(a=e.sent){e.next=7;break}throw new f.InvalidAddressOrEnsError;case 7:r=a;case 8:e.t0=t.type,e.next=e.t0===f.TokenType.NATIVE?11:e.t0===f.TokenType.ERC20?14:e.t0===f.TokenType.ERC721?19:e.t0===f.TokenType.ERC1155?24:29;break;case 11:return e.next=13,We.strict().validate(t);case 13:return e.abrupt("return",{to:r,value:t.amount,data:new Uint8Array});case 14:return e.next=16,je.strict().validate(t);case 16:return s=new o.Contract(t.tokenAddress,i.abi).interface,d=s.encodeFunctionData("transfer",[t.recipientAddressOrEns,t.amount]),e.abrupt("return",{to:t.tokenAddress,value:BigInt(0),data:f.hexToBytes(d)});case 19:return e.next=21,Ke.strict().validate(t);case 21:return s=new o.Contract(t.tokenAddress,u.abi).interface,d=s.encodeFunctionData("safeTransferFrom(address,address,uint256)",[t.daoAddressOrEns,t.recipientAddressOrEns,t.tokenId]),e.abrupt("return",{to:t.tokenAddress,value:BigInt(0),data:f.hexToBytes(d)});case 24:return e.next=26,Ye.strict().validate(t);case 26:return s=new o.Contract(t.tokenAddress,c.abi).interface,d=1===t.tokenIds.length?s.encodeFunctionData("safeTransferFrom(address,address,uint256,uint256,bytes)",[t.daoAddressOrEns,t.recipientAddressOrEns,t.tokenIds[0],t.amounts[0],new Uint8Array]):s.encodeFunctionData("safeBatchTransferFrom(address,address,uint256[],uint256[],bytes)",[t.daoAddressOrEns,t.recipientAddressOrEns,t.tokenIds,t.amounts,new Uint8Array]),e.abrupt("return",{to:t.tokenAddress,value:BigInt(0),data:f.hexToBytes(d)});case 29:throw new f.NotImplementedError("Token type not supported");case 30:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.updateDaoMetadataAction=function(){var e=O(x().mark((function e(t,n){var a,s,o,i,u,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.AddressOrEnsSchema.strict().validate(t);case 2:return e.next=4,f.IpfsUriSchema.strict().validate(n);case 4:if(a=t,g.isAddress(t)){e.next=12;break}return e.next=8,null==(s=this.web3.getSigner())?void 0:s.resolveName(t);case 8:if(o=e.sent){e.next=11;break}throw new f.InvalidEnsError;case 11:a=o;case 12:return i=r.DAO__factory.createInterface(),u=l.toUtf8Bytes(n),c=i.encodeFunctionData("setMetadata",[u]),e.abrupt("return",{to:a,value:BigInt(0),data:f.hexToBytes(c)});case 16:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),a.setDaoUriAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),m.string().url().strict().validateSync(t);var n=r.DAO__factory.createInterface().encodeFunctionData("setDaoURI",[t]);return{to:e,value:BigInt(0),data:f.hexToBytes(n)}},a.registerStandardCallbackAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),Ze.strict().validateSync(t);var n=r.DAO__factory.createInterface().encodeFunctionData("registerStandardCallback",[t.interfaceId,t.callbackSelector,t.magicNumber]);return{to:e,value:BigInt(0),data:f.hexToBytes(n)}},a.setSignatureValidatorAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),f.AddressOrEnsSchema.strict().validateSync(t);var n=r.DAO__factory.createInterface().encodeFunctionData("setSignatureValidator",[t]);return{to:e,value:BigInt(0),data:f.hexToBytes(n)}},a.upgradeToAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),f.AddressOrEnsSchema.strict().validateSync(t);var n=r.DAO__factory.createInterface().encodeFunctionData("upgradeTo",[t]);return{to:e,value:BigInt(0),data:f.hexToBytes(n)}},a.upgradeToAndCallAction=function(e,t){f.AddressOrEnsSchema.strict().validateSync(e),Xe.strict().validateSync(t);var n=r.DAO__factory.createInterface().encodeFunctionData("upgradeToAndCall",[t.implementationAddress,t.data]);return{to:e,value:BigInt(0),data:f.hexToBytes(n)}},a.initializeFromAction=function(e,t){var n;f.AddressOrEnsSchema.strict().validateSync(e),ze.strict().validateSync(t);var a=r.DAO__factory.createInterface().encodeFunctionData("initializeFrom",[t.previousVersion,null!=(n=t.initData)?n:new Uint8Array]);return{to:e,value:BigInt(0),data:f.hexToBytes(a)}},a.daoUpdateAction=function(){var e=O(x().mark((function e(t,n){var a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.AddressOrEnsSchema.strict().validateSync(t),Je.strict().validateSync(n),a=this.initializeFromAction(t,n),o=r.DAOFactory__factory.connect(null!=(s=n.daoFactoryAddress)?s:this.web3.getAddress(v.FrameworkContractsNames.DAO_FACTORY),this.web3.getProvider()),e.next=7,o.daoBase();case 7:return e.abrupt("return",this.upgradeToAndCallAction(t,{implementationAddress:e.sent,data:a.data}));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),t}(f.ClientCore),Zt=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.prepareInstallation=function(){var e=O(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.PrepareInstallationSchema.strict().validate(t);case 2:return e.abrupt("return",f.prepareGenericInstallationEstimation(this.web3,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.createDao=function(){var e=O(x().mark((function e(t){var n,a,o,i,u,c,d,p,f,m,g;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Re.strict().validate(t);case 2:i=this.web3.getProvider(),u=r.DAOFactory__factory.connect(this.web3.getAddress(v.FrameworkContractsNames.DAO_FACTORY),i),c=[],d=V(t.plugins);case 6:if((p=d()).done){e.next=18;break}return m=r.PluginRepo__factory.connect((f=p.value).id,i),e.next=11,m.latestRelease();case 11:return g=e.sent,e.next=14,m["getLatestVersion(uint8)"](g);case 14:c.push({pluginSetupRef:{pluginSetupRepo:m.address,versionTag:e.sent.tag},data:f.data});case 16:e.next=6;break;case 18:return e.next=20,u.estimateGas.createDao({subdomain:null!=(n=t.ensSubdomain)?n:"",metadata:l.toUtf8Bytes(t.metadataUri),daoURI:null!=(a=t.daoUri)?a:"",trustedForwarder:null!=(o=t.trustedForwarder)?o:s.AddressZero},c);case 20:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.deposit=function(){var e=O(x().mark((function e(t){var r,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.web3.getConnectedSigner(),e.t0=t.type,e.next=e.t0===f.TokenType.NATIVE?4:e.t0===f.TokenType.ERC20?10:e.t0===f.TokenType.ERC721?16:e.t0===f.TokenType.ERC1155?22:28;break;case 4:return e.next=6,Ce.strict().validate(t);case 6:return e.next=8,ct(r,t);case 8:case 14:case 20:case 26:return n=e.sent,e.abrupt("break",29);case 10:return e.next=12,Ue.strict().validate(t);case 12:return e.next=14,pt(r,t);case 16:return e.next=18,Ve.strict().validate(t);case 18:return e.next=20,ft(r,t);case 22:return e.next=24,Le.strict().validate(t);case 24:return e.next=26,gt(r,t);case 28:throw new f.NotImplementedError("Token type not valid");case 29:return e.abrupt("return",this.web3.getApproximateGasFee(n.toBigInt()));case 30:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.setAllowance=function(){var e=O(x().mark((function e(t){var r,n,a,s,u,c=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Be.strict().validate(t);case 2:if(r=this.web3.getConnectedSigner(),g.isAddress(n=t.spender)){e.next=16;break}return e.next=7,this.web3.ensureOnline();case 7:if(a=this.web3.getProvider()){e.next=10;break}throw new f.NoProviderError;case 10:return e.next=12,a.resolveName(n);case 12:if(s=e.sent){e.next=15;break}throw new f.InvalidAddressOrEnsError;case 15:n=s;case 16:return u=new o.Contract(t.tokenAddress,i.abi,r),e.abrupt("return",u.estimateGas.approve(n,t.amount).then((function(e){return c.web3.getApproximateGasFee(e.toBigInt())})));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.prepareUpdate=function(){var e=O(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.prepareGenericUpdateEstimation(this.web3,this.graphql,D({},t,{pluginSetupProcessorAddress:this.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(f.ClientCore),Xt=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.applyInstallationAction=function(e){f.Uint8ArraySchema.strict().validateSync(e);var t=r.PluginSetupProcessor__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("applyInstallation");return st(t.decodeFunctionData(a,n))},n.applyUninstallationAction=function(e){f.Uint8ArraySchema.strict().validateSync(e);var t=r.PluginSetupProcessor__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("applyUninstallation");return st(t.decodeFunctionData(a,n))},n.applyUpdateAction=function(e){return It(e)},n.grantAction=function(e){return f.Uint8ArraySchema.strict().validate(e),vt(e)},n.grantWithConditionAction=function(e){f.Uint8ArraySchema.strict().validateSync(e);var t,n=r.DAO__factory.createInterface(),a=f.bytesToHex(e),s=n.getFunction("grantWithCondition");return D({},it(t=n.decodeFunctionData(s,a)),{condition:t[3]})},n.revokeAction=function(e){f.Uint8ArraySchema.strict().validateSync(e);var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("revoke");return it(t.decodeFunctionData(a,n))},n.withdrawAction=function(e,t,r){if(f.AddressOrEnsSchema.strict().validateSync(e),f.BigintSchema.strict().validateSync(t),f.Uint8ArraySchema.strict().validateSync(r),null==r||!r.length)return{type:f.TokenType.NATIVE,recipientAddressOrEns:e,amount:t};for(var n=0,a=[{tokenStandard:f.TokenType.ERC20,abi:i.abi,batch:!1,function:"transfer"},{tokenStandard:f.TokenType.ERC721,abi:u.abi,batch:!1,function:"safeTransferFrom(address,address,uint256)"},{tokenStandard:f.TokenType.ERC1155,abi:c.abi,batch:!0,function:"safeBatchTransferFrom(address,address,uint256[],uint256[],bytes)"},{tokenStandard:f.TokenType.ERC1155,abi:c.abi,batch:!1,function:"safeTransferFrom(address,address,uint256,uint256,bytes)"}];n<a.length;n++){var d=a[n];try{var p=f.bytesToHex(r),l=new o.Contract(s.AddressZero,d.abi).interface,m=l.getFunction(d.function);return ut(e,0,l.decodeFunctionData(m,p),d.tokenStandard,d.batch)}catch(e){continue}}throw new f.InvalidActionError},n.updateDaoMetadataRawAction=function(e){f.Uint8ArraySchema.strict().validateSync(e);var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("setMetadata"),s=t.decodeFunctionData(a,n),o=l.toUtf8String(s[0]);return f.resolveIpfsCid(o),o},n.updateDaoMetadataAction=function(){var e=O(x().mark((function e(t){var n,a,s,o,i,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.Uint8ArraySchema.strict().validate(t);case 2:return n=r.DAO__factory.createInterface(),a=f.bytesToHex(t),s=n.getFunction("setMetadata"),o=n.decodeFunctionData(s,a),i=l.toUtf8String(o[0]),u=f.resolveIpfsCid(i),e.prev=8,e.next=11,this.ipfs.fetchString(u);case 11:return e.abrupt("return",JSON.parse(e.sent));case 15:throw e.prev=15,e.t0=e.catch(8),new f.IpfsError(e.t0);case 18:case"end":return e.stop()}}),e,this,[[8,15]])})));return function(t){return e.apply(this,arguments)}}(),n.setDaoUriAction=function(e){f.Uint8ArraySchema.strict().validateSync(e);var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("setDaoURI");return t.decodeFunctionData(a,n)[0]},n.registerStandardCallbackAction=function(e){f.Uint8ArraySchema.strict().validateSync(e);var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("registerStandardCallback"),s=t.decodeFunctionData(a,n);return{interfaceId:s[0],callbackSelector:s[1],magicNumber:s[2]}},n.setSignatureValidatorAction=function(e){f.Uint8ArraySchema.strict().validateSync(e);var t=r.DAO__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("setSignatureValidator");return t.decodeFunctionData(a,n)[0]},n.upgradeToAction=function(e){return Pt(e)},n.upgradeToAndCallAction=function(e){return f.Uint8ArraySchema.strict().validate(e),Et(e)},n.initializeFromAction=function(e){return f.Uint8ArraySchema.strict().validate(e),wt(e)},n.findInterface=function(e){return f.Uint8ArraySchema.strict().validate(e),function(e,t){try{var r=f.getFunctionFragment(e,t);return{id:r.format("minimal"),functionName:r.name,hash:f.bytesToHex(e).substring(0,10)}}catch(e){return null}}(e,ve)},n.daoUpdateAction=function(e){var t=this.upgradeToAndCallAction(e),r=this.initializeFromAction(t.data);return{implementationAddress:t.implementationAddress,previousVersion:r.previousVersion,initData:r.initData}},t}(f.ClientCore),zt=function(e){function t(t){var r;return(r=e.call(this,t)||this).methods=new Kt(t),r.encoding=new Yt(t),r.decoding=new Xt(t),r.estimation=new Zt(t),r}return R(t,e),t}(f.ClientCore);exports.VoteValues=void 0,(Ht=exports.VoteValues||(exports.VoteValues={}))[Ht.ABSTAIN=1]="ABSTAIN",Ht[Ht.YES=2]="YES",Ht[Ht.NO=3]="NO",exports.VotingMode=void 0,(Wt=exports.VotingMode||(exports.VotingMode={})).STANDARD="Standard",Wt.EARLY_EXECUTION="EarlyExecution",Wt.VOTE_REPLACEMENT="VoteReplacement",exports.SubgraphVoteValues=void 0,(jt=exports.SubgraphVoteValues||(exports.SubgraphVoteValues={})).YES="Yes",jt.NO="No",jt.ABSTAIN="Abstain";var Jt,Qt,er,tr=new Map([[exports.SubgraphVoteValues.YES,exports.VoteValues.YES],[exports.SubgraphVoteValues.NO,exports.VoteValues.NO],[exports.SubgraphVoteValues.ABSTAIN,exports.VoteValues.ABSTAIN]]);exports.ProposalSortBy=void 0,(exports.ProposalSortBy||(exports.ProposalSortBy={})).CREATED_AT="createdAt",exports.ProposalCreationSteps=void 0,(Jt=exports.ProposalCreationSteps||(exports.ProposalCreationSteps={})).CREATING="creating",Jt.DONE="done",exports.VoteProposalStep=void 0,(Qt=exports.VoteProposalStep||(exports.VoteProposalStep={})).VOTING="voting",Qt.DONE="done",exports.ExecuteProposalStep=void 0,(er=exports.ExecuteProposalStep||(exports.ExecuteProposalStep={})).EXECUTING="executing",er.DONE="done",exports.MembersSortBy=void 0,(exports.MembersSortBy||(exports.MembersSortBy={})).ADDRESS="address";var rr,nr,ar,sr=r.Multisig__factory.createInterface(),or=r.MajorityVotingBase__factory.createInterface(),ir=[sr.getFunction("addAddresses").format("minimal"),sr.getFunction("removeAddresses").format("minimal"),sr.getFunction("updateMultisigSettings").format("minimal"),or.getFunction("updateVotingSettings").format("minimal")];function ur(e){switch(e){case exports.VotingMode.STANDARD:return 0;case exports.VotingMode.EARLY_EXECUTION:return 1;case exports.VotingMode.VOTE_REPLACEMENT:return 2;default:throw new f.InvalidVotingModeError}}function cr(e){switch(e){case 0:return exports.VotingMode.STANDARD;case 1:return exports.VotingMode.EARLY_EXECUTION;case 2:return exports.VotingMode.VOTE_REPLACEMENT;default:throw new f.InvalidVotingModeError}}function dr(e){var t,n=r.MajorityVotingBase__factory.createInterface(),a=f.bytesToHex(e),s=n.getFunction("updateVotingSettings");return{votingMode:cr((t=n.decodeFunctionData(s,a))[0][0]),supportThreshold:f.decodeRatio(t[0][1],6),minParticipation:f.decodeRatio(t[0][2],6),minDuration:t[0][3].toNumber(),minProposerVotingPower:BigInt(t[0][4])}}function pr(e){var t=r.MajorityVotingBase__factory.createInterface(),n=lr(e),a=t.encodeFunctionData("updateVotingSettings",[{votingMode:n[0],supportThreshold:n[1],minParticipation:n[2],minDuration:n[3],minProposerVotingPower:n[4]}]);return f.hexToBytes(a)}function lr(e){var t;return[a.BigNumber.from(ur(e.votingMode||exports.VotingMode.STANDARD)),a.BigNumber.from(f.encodeRatio(e.supportThreshold,6)),a.BigNumber.from(f.encodeRatio(e.minParticipation,6)),a.BigNumber.from(e.minDuration),a.BigNumber.from(null!=(t=e.minProposerVotingPower)?t:0)]}exports.DaoRole=void 0,(rr=exports.DaoRole||(exports.DaoRole={})).UPGRADE_ROLE="UPGRADE_ROLE",rr.DAO_CONFIG_ROLE="DAO_CONFIG_ROLE",rr.EXEC_ROLE="EXEC_ROLE",rr.WITHDRAW_ROLE="WITHDRAW_ROLE",rr.SET_SIGNATURE_VALIDATOR_ROLE="SET_SIGNATURE_VALIDATOR_ROLE";var fr,mr,gr,hr=d.gql(nr||(nr=C(["\nquery AddresslistVotingMembers($where: AddresslistVotingVoter_filter!, $block: Block_height, $limit: Int!, $skip: Int!, $sortBy: AddresslistVotingVoter_orderBy!, $direction: OrderDirection!) {\n  addresslistVotingVoters(\n    where: $where\n    block: $block\n    first: $limit\n    skip: $skip\n    orderBy: $sortBy\n    orderDirection: $direction\n  ) {\n    address\n  }\n}"]))),vr=d.gql(ar||(ar=C(["\nquery AddresslistVotingIsMember($id: ID!, $block: Block_height) {\n  addresslistVotingVoter(\n    id: $id\n    block: $block\n  ) {\n    id\n  }\n}"]))),Ar=d.gql(fr||(fr=C(["\nquery AddresslistVotingProposal($proposalId: ID!) {\n  addresslistVotingProposal(id: $proposalId){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    createdAt\n    creationBlockNumber\n    executionDate\n    executionBlockNumber\n    actions {\n      to\n      value\n      data\n    }\n    yes\n    no\n    abstain\n    votingMode\n    supportThreshold\n    startDate\n    endDate\n    executed\n    earlyExecutable\n    approvalReached\n    isSignaling\n    executionTxHash\n    voters{\n      voter{\n        address\n      }\n      voteOption\n      voteReplaced\n    }\n    totalVotingPower\n    minVotingPower\n  }\n}\n"]))),Ir=d.gql(mr||(mr=C(["\nquery AddresslistVotingProposals($where: AddresslistVotingProposal_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: AddresslistVotingProposal_orderBy!) {\n  addresslistVotingProposals(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    dao {\n      id\n      subdomain\n    }\n    actions {\n      to\n      value\n      data\n    }\n    creator\n    metadata\n    yes\n    no\n    abstain\n    startDate\n    endDate\n    executed\n    earlyExecutable\n    approvalReached\n    isSignaling\n    voters{\n      voter{\n        address\n      }\n      voteOption\n      voteReplaced\n    }\n  }\n}\n"]))),yr=d.gql(gr||(gr=C(["\nquery AddresslistVotingSettings($address: ID!, $block: Block_height) {\n  addresslistVotingPlugin(id: $address, block: $block){\n    minDuration\n    minProposerVotingPower\n    minParticipation\n    supportThreshold\n    votingMode\n  }\n}\n"])));function Er(e,t){var r=new Date(1e3*parseInt(e.startDate)),n=new Date(1e3*parseInt(e.endDate)),a=new Date(1e3*parseInt(e.createdAt)),s=e.executionDate?new Date(1e3*parseInt(e.executionDate)):null;return{id:f.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:t.title,summary:t.summary,description:t.description,resources:t.resources,media:t.media},metadataHash:e.metadata,startDate:r,endDate:n,creationDate:a,executionTxHash:e.executionTxHash||null,creationBlockNumber:parseInt(e.creationBlockNumber),executionDate:s,executionBlockNumber:parseInt(e.executionBlockNumber)||null,actions:e.actions.map((function(e){return{data:f.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}})),status:wr(e),result:{yes:e.yes?parseInt(e.yes):0,no:e.no?parseInt(e.no):0,abstain:e.abstain?parseInt(e.abstain):0},settings:{supportThreshold:f.decodeRatio(BigInt(e.supportThreshold),6),minParticipation:f.decodeRatio(BigInt(e.minVotingPower)*BigInt(1e6)/BigInt(e.totalVotingPower),6),duration:parseInt(e.endDate)-parseInt(e.startDate)},totalVotingWeight:parseInt(e.totalVotingPower),votes:e.voters.map((function(e){return{voteReplaced:e.voteReplaced,address:e.voter.address,vote:tr.get(e.voteOption)}}))}}function Pr(e,t){var r=new Date(1e3*parseInt(e.startDate)),n=new Date(1e3*parseInt(e.endDate));return{id:f.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:t.title,summary:t.summary},metadataHash:e.metadata,startDate:r,endDate:n,status:wr(e),result:{yes:e.yes?parseInt(e.yes):0,no:e.no?parseInt(e.no):0,abstain:e.abstain?parseInt(e.abstain):0},actions:e.actions.map((function(e){return{data:f.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}})),votes:e.voters.map((function(e){return{voteReplaced:e.voteReplaced,address:e.voter.address,vote:tr.get(e.voteOption)}}))}}function wr(e){var t=new Date,r=new Date(1e3*parseInt(e.startDate)),n=new Date(1e3*parseInt(e.endDate));return e.executed?f.ProposalStatus.EXECUTED:r>=t?f.ProposalStatus.PENDING:e.approvalReached&&n<=t||e.earlyExecutable?f.ProposalStatus.SUCCEEDED:t<n?f.ProposalStatus.ACTIVE:f.ProposalStatus.DEFEATED}function Sr(e){var t={},r=Math.round((new Date).getTime()/1e3).toString();switch(e){case f.ProposalStatus.PENDING:t={startDate_gte:r};break;case f.ProposalStatus.ACTIVE:t={startDate_lt:r,endDate_gte:r,executed:!1};break;case f.ProposalStatus.EXECUTED:t={executed:!0};break;case f.ProposalStatus.SUCCEEDED:t={or:[{approvalReached:!0,endDate_lt:r},{earlyExecutable:!0}]};break;case f.ProposalStatus.DEFEATED:t={potentiallyExecutable:!1,endDate_lt:r,executed:!1};break;default:throw new f.InvalidProposalStatusError}return t}var br,_r,xr,Tr,kr,Or,Dr,Rr,Nr=[r.MajorityVotingBase__factory.createInterface().getFunction("updateVotingSettings").format("minimal"),r.AddresslistVoting__factory.createInterface().getFunction("addAddresses").format("minimal"),r.AddresslistVoting__factory.createInterface().getFunction("removeAddresses").format("minimal")],Cr={1:[]},Ur=[{components:[{internalType:"enum MajorityVotingBase.VotingMode",name:"votingMode",type:"uint8",description:"A parameter to select the vote mode. In standard mode (0), early execution and vote replacement are disabled. In early execution mode (1), a proposal can be executed early before the end date if the vote outcome cannot mathematically change by more voters voting. In vote replacement mode (2), voters can change their vote multiple times and only the latest vote option is tallied."},{internalType:"uint32",name:"supportThreshold",type:"uint32",description:"The support threshold value. Its value has to be in the interval [0, 10^6] defined by `RATIO_BASE = 10**6`."},{internalType:"uint32",name:"minParticipation",type:"uint32",description:"The minimum participation value. Its value has to be in the interval [0, 10^6] defined by `RATIO_BASE = 10**6`."},{internalType:"uint64",name:"minDuration",type:"uint64",description:"The minimum duration of the proposal vote in seconds."},{internalType:"uint256",name:"minProposerVotingPower",type:"uint256",description:"The minimum voting power required to create a proposal."}],internalType:"struct MajorityVotingBase.VotingSettings",name:"votingSettings",type:"tuple",description:"The voting settings that will be enforced when proposals are created."},{internalType:"address[]",name:"members",type:"address[]",description:"The addresses of the initial members to be added."}],Vr=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.createProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u,c,d,p,m,g,h,v,A,I,y;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(u=t.web3.getConnectedSigner(),c=r.AddresslistVoting__factory.connect(e.pluginAddress,u),null==(a=e.failSafeActions)||!a.length||e.failSafeActions.length===(null==(s=e.actions)?void 0:s.length)){n.next=4;break}throw new f.SizeMismatchError("failSafeActions","actions");case 4:return d=f.boolArrayToBitmap(e.failSafeActions),p=(null==(o=e.startDate)?void 0:o.getTime())||0,m=(null==(i=e.endDate)?void 0:i.getTime())||0,n.next=9,_(c.createProposal(l.toUtf8Bytes(e.metadataUri),e.actions||[],d,Math.round(p/1e3),Math.round(m/1e3),e.creatorVote||0,e.executeOnPass||!1));case 9:return g=n.sent,n.next=12,{key:exports.ProposalCreationSteps.CREATING,txHash:g.hash};case 12:return n.next=14,_(g.wait());case 14:if(h=n.sent,v=r.AddresslistVoting__factory.createInterface(),A=f.findLog(h,v,"ProposalCreated")){n.next=19;break}throw new f.ProposalCreationError;case 19:if(I=v.parseLog(A),y=I.args.proposalId){n.next=23;break}throw new f.ProposalCreationError;case 23:return n.next=25,{key:exports.ProposalCreationSteps.DONE,proposalId:f.encodeProposalId(e.pluginAddress,Number(y))};case 25:case"end":return n.stop()}}),n)})))()},n.pinMetadata=function(){var e=O(x().mark((function e(t){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ipfs.add(JSON.stringify(t));case 3:return r=e.sent,e.next=6,this.ipfs.pin(r);case 6:return e.abrupt("return","ipfs://"+r);case 9:throw e.prev=9,e.t0=e.catch(0),new f.IpfsPinError(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),n.voteProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.web3.getConnectedSigner(),s=f.decodeProposalId(e.proposalId),o=s.id,i=r.AddresslistVoting__factory.connect(s.pluginAddress,a),n.next=5,_(i.vote(o,e.vote,!1));case 5:return u=n.sent,n.next=8,{key:exports.VoteProposalStep.VOTING,txHash:u.hash};case 8:return n.next=10,_(u.wait());case 10:return n.next=12,{key:exports.VoteProposalStep.DONE};case 12:case"end":return n.stop()}}),n)})))()},n.executeProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.web3.getConnectedSigner(),s=f.decodeProposalId(e),o=s.id,i=r.AddresslistVoting__factory.connect(s.pluginAddress,a),n.next=5,_(i.execute(o));case 5:return u=n.sent,n.next=8,{key:exports.ExecuteProposalStep.EXECUTING,txHash:u.hash};case 8:return n.next=10,_(u.wait());case 10:return n.next=12,{key:exports.ExecuteProposalStep.DONE};case 12:case"end":return n.stop()}}),n)})))()},n.prepareInstallation=function(e){var t=this;return T(x().mark((function r(){var n;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,_(t.web3.getProvider().getNetwork());case 2:if(v.getNetworkByAlias((n=r.sent).name)){r.next=6;break}throw new f.UnsupportedNetworkError(n.name);case 6:return r.delegateYield(w(S(f.prepareGenericInstallation(t.web3,{daoAddressOrEns:e.daoAddressOrEns,pluginRepo:t.web3.getAddress(v.NonFrameworkContractsNames.ADDRESSLIST_VOTING_REPO_PROXY),version:e.versionTag,installationAbi:Ur,installationParams:[lr(e.settings.votingSettings),e.settings.addresses],pluginSetupProcessorAddress:t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)}))),"t0",7);case 7:case"end":return r.stop()}}),r)})))()},n.prepareUpdate=function(e){var t=this;return T(x().mark((function r(){return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(w(S(f.prepareGenericUpdate(t.web3,t.graphql,D({},e,{pluginRepo:t.web3.getAddress(v.NonFrameworkContractsNames.ADDRESSLIST_VOTING_REPO_PROXY),updateAbi:Cr[e.newVersion.build]||e.updateAbi||[],pluginSetupProcessorAddress:t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)})))),"t0",1);case 1:case"end":return r.stop()}}),r)})))()},n.canVote=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getProvider(),a=f.decodeProposalId(t.proposalId),s=a.id,o=r.AddresslistVoting__factory.connect(a.pluginAddress,n),e.abrupt("return",o.callStatic.canVote(s,t.voterAddressOrEns,t.vote));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.canExecute=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getProvider(),a=f.decodeProposalId(t),s=a.id,o=r.AddresslistVoting__factory.connect(a.pluginAddress,n),e.abrupt("return",o.canExecute(s));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getMembers=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.pluginAddress,n=t.blockNumber,s=void 0===(a=t.limit)?10:a,i=void 0===(o=t.skip)?0:o,c=void 0===(u=t.direction)?f.SortDirection.ASC:u,p=void 0===(d=t.sortBy)?exports.MembersSortBy.ADDRESS:d,g.isAddress(r)){e.next=3;break}throw new f.InvalidAddressError;case 3:return l=hr,m={where:{plugin:r.toLowerCase()},block:n?{number:n}:null,skip:i,limit:s,direction:c,sortBy:p},e.next=8,this.graphql.request({query:l,params:m,name:"AddresslistVotingVoting members"});case 8:return e.abrupt("return",e.sent.addresslistVotingVoters.map((function(e){return e.address})));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getProposal=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.isProposalId(t)){e.next=2;break}throw new f.InvalidProposalIdError;case 2:return r=f.getExtendedProposalId(t),n=Ar,a={proposalId:r},e.next=8,this.graphql.request({query:n,params:a,name:"AddresslistVoting proposal"});case 8:if(s=e.sent.addresslistVotingProposal){e.next=14;break}return e.abrupt("return",null);case 14:if(s.metadata){e.next=16;break}return e.abrupt("return",Er(s,f.EMPTY_PROPOSAL_METADATA_LINK));case 16:return e.prev=16,o=f.resolveIpfsCid(s.metadata),e.next=20,this.ipfs.fetchString(o);case 20:return i=JSON.parse(e.sent),e.abrupt("return",Er(s,i));case 25:if(e.prev=25,e.t0=e.catch(16),!(e.t0 instanceof f.InvalidCidError)){e.next=29;break}return e.abrupt("return",Er(s,f.UNSUPPORTED_PROPOSAL_METADATA_LINK));case 29:return e.abrupt("return",Er(s,f.UNAVAILABLE_PROPOSAL_METADATA));case 30:case"end":return e.stop()}}),e,this,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),n.getProposals=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m,h,v,A,I=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0===(r=t.limit)?10:r,a=t.status,o=void 0===(s=t.skip)?0:s,u=void 0===(i=t.direction)?f.SortDirection.ASC:i,d=void 0===(c=t.sortBy)?exports.ProposalSortBy.CREATED_AT:c,p={},!(l=t.daoAddressOrEns)){e.next=23;break}if(g.isAddress(l)){e.next=22;break}return e.next=7,this.web3.ensureOnline();case 7:if(m=this.web3.getProvider()){e.next=10;break}throw new f.NoProviderError;case 10:return e.prev=10,e.next=13,m.resolveName(l);case 13:if(h=e.sent){e.next=16;break}throw new f.InvalidAddressOrEnsError;case 16:l=h,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new f.InvalidAddressOrEnsError;case 22:p={dao:l.toLowerCase()};case 23:return a&&(p=D({},p,Sr(a))),v=Ir,A={where:p,limit:n,skip:o,direction:u,sortBy:d},e.next=29,this.graphql.request({query:v,params:A,name:"AddresslistVoting proposals"});case 29:return e.abrupt("return",Promise.all(e.sent.addresslistVotingProposals.map(function(){var e=O(x().mark((function e(t){var r,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.metadata){e.next=2;break}return e.abrupt("return",Pr(t,f.EMPTY_PROPOSAL_METADATA_LINK));case 2:return e.prev=2,r=f.resolveIpfsCid(t.metadata),e.next=6,f.promiseWithTimeout(I.ipfs.fetchString(r),f.MULTI_FETCH_TIMEOUT);case 6:return n=JSON.parse(e.sent),e.abrupt("return",Pr(t,n));case 11:if(e.prev=11,e.t0=e.catch(2),!(e.t0 instanceof f.InvalidCidError)){e.next=15;break}return e.abrupt("return",Pr(t,f.UNSUPPORTED_PROPOSAL_METADATA_LINK));case 15:return e.abrupt("return",Pr(t,f.UNAVAILABLE_PROPOSAL_METADATA));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())));case 32:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),n.getVotingSettings=function(){var e=O(x().mark((function e(t,r){var n,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.isAddress(t)){e.next=2;break}throw new f.InvalidAddressError;case 2:return n=yr,a={address:t.toLowerCase(),block:r?{number:r}:null},e.next=7,this.graphql.request({query:n,params:a,name:"AddresslistVoting settings"});case 7:if(s=e.sent.addresslistVotingPlugin){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",{minDuration:parseInt(s.minDuration),supportThreshold:f.decodeRatio(BigInt(s.supportThreshold),6),minParticipation:f.decodeRatio(BigInt(s.minParticipation),6),minProposerVotingPower:BigInt(s.minProposerVotingPower),votingMode:s.votingMode});case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),n.isMember=function(){var e=O(x().mark((function e(t){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.IsMemberSchema.strict().validateSync(t),r=vr,e.next=5,this.graphql.request({query:r,params:{id:t.pluginAddress.toLowerCase()+"_"+t.address.toLowerCase(),blockHeight:t.blockNumber?{number:t.blockNumber}:null},name:"AddresslistVoting isMember"});case 5:return e.abrupt("return",!!e.sent.addresslistVotingVoter);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(f.ClientCore),Lr=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t.getPluginInstallItem=function(e,t){var r,a=f.getNetwork(t).name,s=v.getNetworkNameByAlias(a);if(!s)throw new f.UnsupportedNetworkError(a);var o=n.defaultAbiCoder.encode(f.getNamedTypesFromMetadata(Ur),[lr(e.votingSettings),e.addresses]),i=null==(r=v.contracts[s][v.SupportedVersions.V1_3_0])||null==(r=r.AddresslistVotingRepoProxy)?void 0:r.address;if(!i)throw new Error("AddresslistVotingRepoProxy address not found");return{id:i,data:f.hexToBytes(o)}};var a=t.prototype;return a.updatePluginSettingsAction=function(e,t){if(!g.isAddress(e))throw new f.InvalidAddressError;return{to:e,value:BigInt(0),data:pr(t)}},a.addMembersAction=function(e,t){if(!g.isAddress(e))throw new f.InvalidAddressError;for(var n,a=V(t);!(n=a()).done;)if(!g.isAddress(n.value))throw new f.InvalidAddressError;var s=r.AddresslistVoting__factory.createInterface().encodeFunctionData("addAddresses",[t]);return{to:e,value:BigInt(0),data:f.hexToBytes(s)}},a.removeMembersAction=function(e,t){if(!g.isAddress(e))throw new f.InvalidAddressError;for(var n,a=V(t);!(n=a()).done;)if(!g.isAddress(n.value))throw new f.InvalidAddressError;var s=r.AddresslistVoting__factory.createInterface().encodeFunctionData("removeAddresses",[t]);return{to:e,value:BigInt(0),data:f.hexToBytes(s)}},t}(f.ClientCore),Br=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.updatePluginSettingsAction=function(e){return dr(e)},n.addMembersAction=function(e){var t=r.AddresslistVoting__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("addAddresses");return t.decodeFunctionData(a,n)[0]},n.removeMembersAction=function(e){var t=r.AddresslistVoting__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("removeAddresses");return t.decodeFunctionData(a,n)[0]},n.findInterface=function(e){try{var t=f.getFunctionFragment(e,Nr);return{id:t.format("minimal"),functionName:t.name,hash:f.bytesToHex(e).substring(0,10)}}catch(e){return null}},t}(f.ClientCore),Mr=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.createProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o,i,u,c,d,p;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.web3.getConnectedSigner(),u=r.AddresslistVoting__factory.connect(t.pluginAddress,i),null==(n=t.failSafeActions)||!n.length||t.failSafeActions.length===(null==(a=t.actions)?void 0:a.length)){e.next=4;break}throw new f.SizeMismatchError("failSafeActions","actions");case 4:return c=f.boolArrayToBitmap(t.failSafeActions),d=(null==(s=t.startDate)?void 0:s.getTime())||0,p=(null==(o=t.endDate)?void 0:o.getTime())||0,e.next=9,u.estimateGas.createProposal(l.toUtf8Bytes(t.metadataUri),t.actions||[],c,Math.round(d/1e3),Math.round(p/1e3),t.creatorVote||0,t.executeOnPass||!1);case 9:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.voteProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getConnectedSigner(),a=f.decodeProposalId(t.proposalId),s=a.id,o=r.AddresslistVoting__factory.connect(a.pluginAddress,n),e.next=5,o.estimateGas.vote(s,t.vote,!1);case 5:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.executeProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getConnectedSigner(),a=f.decodeProposalId(t),s=a.id,o=r.AddresslistVoting__factory.connect(a.pluginAddress,n),e.next=5,o.estimateGas.execute(s);case 5:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.prepareUpdate=function(){var e=O(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.prepareGenericUpdateEstimation(this.web3,this.graphql,D({},t,{pluginSetupProcessorAddress:this.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR),pluginRepo:this.web3.getAddress(v.NonFrameworkContractsNames.ADDRESSLIST_VOTING_REPO_PROXY)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(f.ClientCore),Gr=function(e){function t(t){var r;return(r=e.call(this,t)||this).methods=new Vr(t),r.encoding=new Lr(t),r.decoding=new Br(t),r.estimation=new Mr(t),r}return R(t,e),t}(f.ClientCore);Gr.encoding={getPluginInstallItem:function(e,t){return Lr.getPluginInstallItem(e,t)}},exports.WrapTokensStep=void 0,(br=exports.WrapTokensStep||(exports.WrapTokensStep={})).WRAPPING="wrapping",br.DONE="done",exports.UnwrapTokensStep=void 0,(_r=exports.UnwrapTokensStep||(exports.UnwrapTokensStep={})).UNWRAPPING="unwrapping",_r.DONE="done",function(e){e.ERC20="ERC20Token",e.ERC721="ERC721Token"}(xr||(xr={})),function(e){e.ERC20="ERC20Contract",e.ERC20_WRAPPER="ERC20WrapperContract",e.ERC721="ERC721Contract"}(Tr||(Tr={})),function(e){e.ADDRESS="address",e.BALANCE="balance",e.VOTING_POWER="votingPower"}(kr||(kr={})),function(e){e.COMPATIBLE="compatible",e.NEEDS_WRAPPING="needsWrapping",e.INCOMPATIBLE="incompatible"}(Or||(Or={}));var qr,Fr,$r,Hr,Wr=d.gql(Dr||(Dr=C(["\nquery TokenVotingProposal($proposalId: ID!) {\n  tokenVotingProposal(id: $proposalId){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    createdAt\n    creationBlockNumber\n    executionDate\n    executionBlockNumber\n    actions {\n      to\n      value\n      data\n    }\n    yes,\n    no,\n    abstain\n    votingMode\n    supportThreshold\n    startDate\n    endDate\n    executed\n    earlyExecutable\n    approvalReached\n    isSignaling\n    executionTxHash\n    voters(first: 1000){\n      voter{\n        address\n      }\n      voteReplaced\n      voteOption\n      votingPower\n    }\n    plugin {\n      token {\n        id\n        name\n        symbol\n        __typename\n        ...on ERC20Contract {\n          decimals\n        }\n        ...on ERC20WrapperContract {\n          decimals\n          underlyingToken{\n            id\n            name\n            symbol\n            decimals\n          }\n        }\n      }\n    }\n    totalVotingPower\n    minVotingPower\n  }\n}\n"]))),jr=d.gql(Rr||(Rr=C(["\nquery TokenVotingProposals($where: TokenVotingProposal_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: TokenVotingProposal_orderBy!) {\n  tokenVotingProposals(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    yes,\n    no,\n    abstain\n    startDate\n    endDate\n    executed\n    earlyExecutable\n    approvalReached\n    isSignaling\n    votingMode\n    supportThreshold\n    minVotingPower\n    totalVotingPower\n    actions {\n      to\n      value\n      data\n    }\n    voters{\n      voter{\n        address\n      }\n      voteReplaced\n      voteOption\n      votingPower\n    }\n    plugin{\n      token{\n        id\n        name\n        symbol\n        __typename\n        ...on ERC20Contract {\n          decimals\n        }\n        ...on ERC20WrapperContract {\n          decimals\n          underlyingToken{\n            id\n            name\n            symbol\n            decimals\n          }\n        }\n      }\n    }\n  }\n}\n"]))),Kr=d.gql(qr||(qr=C(["\nquery TokenVotingSettings($address: ID!,$block: Block_height) {\n  tokenVotingPlugin(id: $address, block: $block){\n    minDuration\n    minProposerVotingPower\n    minParticipation\n    supportThreshold\n    votingMode\n  }\n}\n"]))),Yr=d.gql(Fr||(Fr=C(["\nquery TokenVotingPlugin($address: ID!) {\n  tokenVotingPlugin(id: $address){\n    token {\n      id\n      name\n      symbol\n      __typename\n      ...on ERC20WrapperContract {\n        decimals\n        underlyingToken{\n          id\n          name\n          symbol\n          decimals\n        }\n      }\n      ...on ERC20Contract {\n        decimals\n      }\n    }\n  }\n}\n"]))),Zr=d.gql($r||($r=C(["\nquery TokenVotingMembers($where: TokenVotingMember_filter!, $block: Block_height, $limit: Int!, $skip: Int!, $sortBy: TokenVotingMember_orderBy!, $direction: OrderDirection!) {\n  tokenVotingMembers(\n    where: $where\n    block: $block\n    first: $limit\n    skip: $skip\n    orderBy: $sortBy\n    orderDirection: $direction\n  ) {\n    address\n    balance\n    votingPower\n    delegatee{\n      address\n    }\n    delegators{\n      address\n      balance\n    }\n  }\n}\n"]))),Xr=d.gql(Hr||(Hr=C(["\nquery TokenVotingIsMember($id: ID!, $block: Block_height) {\n  tokenVotingMember(\n    id: $id\n    block: $block\n  ) {\n    id\n  }\n}"])));function zr(e,t){for(var r,n=new Date(1e3*parseInt(e.startDate)),a=new Date(1e3*parseInt(e.endDate)),s=new Date(1e3*parseInt(e.createdAt)),o=e.executionDate?new Date(1e3*parseInt(e.executionDate)):null,i=BigInt(0),u=V(e.voters);!(r=u()).done;)i+=BigInt(r.value.votingPower);var c=en(e.plugin.token);return{id:f.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:t.title,summary:t.summary,description:t.description,resources:t.resources,media:t.media},metadataHash:e.metadata,startDate:n,endDate:a,creationDate:s,creationBlockNumber:parseInt(e.creationBlockNumber),executionDate:o,executionBlockNumber:parseInt(e.executionBlockNumber)||null,executionTxHash:e.executionTxHash||null,actions:e.actions.map((function(e){return{data:f.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}})),status:rn(e),result:{yes:e.yes?BigInt(e.yes):BigInt(0),no:e.no?BigInt(e.no):BigInt(0),abstain:e.abstain?BigInt(e.abstain):BigInt(0)},settings:{supportThreshold:f.decodeRatio(BigInt(e.supportThreshold),6),duration:parseInt(e.endDate)-parseInt(e.startDate),minParticipation:f.decodeRatio(BigInt(e.minVotingPower)*BigInt(1e6)/BigInt(e.totalVotingPower),6)},token:c,usedVotingWeight:i,totalVotingWeight:BigInt(e.totalVotingPower),votes:e.voters.map((function(e){return{voteReplaced:e.voteReplaced,address:e.voter.address,vote:tr.get(e.voteOption),weight:BigInt(e.votingPower)}}))}}function Jr(e,t){var r=new Date(1e3*parseInt(e.startDate)),n=new Date(1e3*parseInt(e.endDate)),a=en(e.plugin.token);return{id:f.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},settings:{supportThreshold:f.decodeRatio(BigInt(e.supportThreshold),6),duration:parseInt(e.endDate)-parseInt(e.startDate),minParticipation:f.decodeRatio(BigInt(e.minVotingPower)*BigInt(1e6)/BigInt(e.totalVotingPower),6)},creatorAddress:e.creator,metadata:{title:t.title,summary:t.summary},metadataHash:e.metadata,totalVotingWeight:BigInt(e.totalVotingPower),startDate:r,endDate:n,status:rn(e),result:{yes:e.yes?BigInt(e.yes):BigInt(0),no:e.no?BigInt(e.no):BigInt(0),abstain:e.abstain?BigInt(e.abstain):BigInt(0)},token:a,votes:e.voters.map((function(e){return{voteReplaced:e.voteReplaced,address:e.voter.address,vote:tr.get(e.voteOption),weight:BigInt(e.votingPower)}})),actions:e.actions.map((function(e){return{data:f.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}}))}}function Qr(e){var t=["","",""],r=[[],[]];if(e.newToken)t=[s.AddressZero,e.newToken.name,e.newToken.symbol],r=[e.newToken.balances.map((function(e){return e.address})),e.newToken.balances.map((function(e){return a.BigNumber.from(e.balance)}))];else if(e.useToken){var n;t=[null==(n=e.useToken)?void 0:n.tokenAddress,e.useToken.wrappedToken.name,e.useToken.wrappedToken.symbol]}return[lr(e.votingSettings),t,r]}function en(e){var t=null;return e.__typename===Tr.ERC20?t={address:e.id,symbol:e.symbol,name:e.name,decimals:e.decimals,type:f.TokenType.ERC20}:e.__typename===Tr.ERC721?t={address:e.id,symbol:e.symbol,name:e.name,type:f.TokenType.ERC721}:e.__typename===Tr.ERC20_WRAPPER&&(t={address:e.id,symbol:e.symbol,name:e.name,decimals:e.decimals,type:f.TokenType.ERC20,underlyingToken:{address:e.underlyingToken.id,symbol:e.underlyingToken.symbol,name:e.underlyingToken.name,decimals:e.underlyingToken.decimals,type:f.TokenType.ERC20}}),t}function tn(e){var t;return{address:e.address,votingPower:BigInt(e.votingPower),balance:BigInt(e.balance),delegatee:(null==(t=e.delegatee)?void 0:t.address)!==e.address&&e.delegatee?e.delegatee.address:null,delegators:e.delegators.filter((function(t){return t.address!==e.address})).map((function(e){return{address:e.address,balance:BigInt(e.balance)}}))}}function rn(e){var t=new Date,r=new Date(1e3*parseInt(e.startDate)),n=new Date(1e3*parseInt(e.endDate));return e.executed?f.ProposalStatus.EXECUTED:r>=t?f.ProposalStatus.PENDING:e.approvalReached&&n<=t||e.earlyExecutable?f.ProposalStatus.SUCCEEDED:t<n?f.ProposalStatus.ACTIVE:f.ProposalStatus.DEFEATED}function nn(e){var t={},r=Math.round((new Date).getTime()/1e3).toString();switch(e){case f.ProposalStatus.PENDING:t={startDate_gte:r};break;case f.ProposalStatus.ACTIVE:t={startDate_lt:r,endDate_gte:r,executed:!1};break;case f.ProposalStatus.EXECUTED:t={executed:!0};break;case f.ProposalStatus.SUCCEEDED:t={or:[{approvalReached:!0,endDate_lt:r},{earlyExecutable:!0}]};break;case f.ProposalStatus.DEFEATED:t={potentiallyExecutable:!1,endDate_lt:r,executed:!1};break;default:throw new f.InvalidProposalStatusError}return t}function an(e,t){return sn.apply(this,arguments)}function sn(){return(sn=O(x().mark((function e(t,r){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new o.Contract(t,i.abi,r),e.prev=1,e.next=4,Promise.all([n.balanceOf(s.AddressZero),n.decimals()]);case 4:return e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}var on,un,cn,dn=[r.MajorityVotingBase__factory.createInterface().getFunction("updateVotingSettings").format("minimal"),r.IERC20MintableUpgradeable__factory.createInterface().getFunction("mint").format("minimal")],pn={1:[]},ln=[{components:[{internalType:"enum MajorityVotingBase.VotingMode",name:"votingMode",type:"uint8",description:"A parameter to select the vote mode. In standard mode (0), early execution and vote replacement are disabled. In early execution mode (1), a proposal can be executed early before the end date if the vote outcome cannot mathematically change by more voters voting. In vote replacement mode (2), voters can change their vote multiple times and only the latest vote option is tallied."},{internalType:"uint32",name:"supportThreshold",type:"uint32",description:"The support threshold value. Its value has to be in the interval [0, 10^6] defined by `RATIO_BASE = 10**6`."},{internalType:"uint32",name:"minParticipation",type:"uint32",description:"The minimum participation value. Its value has to be in the interval [0, 10^6] defined by `RATIO_BASE = 10**6`."},{internalType:"uint64",name:"minDuration",type:"uint64",description:"The minimum duration of the proposal vote in seconds."},{internalType:"uint256",name:"minProposerVotingPower",type:"uint256",description:"The minimum voting power required to create a proposal."}],internalType:"struct MajorityVotingBase.VotingSettings",name:"votingSettings",type:"tuple",description:"The voting settings that will be enforced when proposals are created."},{components:[{internalType:"address",name:"token",type:"address",description:"The token address. If this is `address(0)`, a new `GovernanceERC20` token is deployed. If not, the existing token is wrapped as an `GovernanceWrappedERC20`."},{internalType:"string",name:"name",type:"string",description:"The token name. This parameter is only relevant if the token address is `address(0)`."},{internalType:"string",name:"symbol",type:"string",description:"The token symbol. This parameter is only relevant if the token address is `address(0)`."}],internalType:"struct TokenVotingSetup.TokenSettings",name:"tokenSettings",type:"tuple",description:"The token settings that either specify an existing ERC-20 token (`token = address(0)`) or the name and symbol of a new `GovernanceERC20` token to be created."},{components:[{internalType:"address[]",name:"receivers",type:"address[]",description:"The receivers of the tokens."},{internalType:"uint256[]",name:"amounts",type:"uint256[]",description:"The amounts of tokens to be minted for each receiver."}],internalType:"struct GovernanceERC20.MintSettings",name:"mintSettings",type:"tuple",description:"The token mint settings struct containing the `receivers` and `amounts`."}],fn=f.getInterfaceId(new n.Interface(y.abi)),mn=[f.getInterfaceId(new n.Interface(I.abi)),f.getInterfaceId(new n.Interface(A.abi)),f.getInterfaceId(r.IGovernanceWrappedERC20__factory.createInterface())],gn=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.createProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u,c,d,p,m,g,h,v,A,I,y;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(u=t.web3.getConnectedSigner(),c=r.TokenVoting__factory.connect(e.pluginAddress,u),null==(a=e.failSafeActions)||!a.length||e.failSafeActions.length===(null==(s=e.actions)?void 0:s.length)){n.next=4;break}throw new f.SizeMismatchError("failSafeActions","actions");case 4:return d=f.boolArrayToBitmap(e.failSafeActions),p=(null==(o=e.startDate)?void 0:o.getTime())||0,m=(null==(i=e.endDate)?void 0:i.getTime())||0,n.next=9,_(c.createProposal(l.toUtf8Bytes(e.metadataUri),e.actions||[],d,Math.round(p/1e3),Math.round(m/1e3),e.creatorVote||0,e.executeOnPass||!1));case 9:return g=n.sent,n.next=12,{key:exports.ProposalCreationSteps.CREATING,txHash:g.hash};case 12:return n.next=14,_(g.wait());case 14:if(h=n.sent,v=r.TokenVoting__factory.createInterface(),A=f.findLog(h,v,"ProposalCreated")){n.next=19;break}throw new f.ProposalCreationError;case 19:if(I=v.parseLog(A),y=I.args.proposalId){n.next=23;break}throw new f.ProposalCreationError;case 23:return n.next=25,{key:exports.ProposalCreationSteps.DONE,proposalId:f.encodeProposalId(e.pluginAddress,Number(y))};case 25:case"end":return n.stop()}}),n)})))()},n.pinMetadata=function(){var e=O(x().mark((function e(t){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ipfs.add(JSON.stringify(t));case 3:return r=e.sent,e.next=6,this.ipfs.pin(r);case 6:return e.abrupt("return","ipfs://"+r);case 9:throw e.prev=9,e.t0=e.catch(0),new f.IpfsPinError(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),n.voteProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.web3.getConnectedSigner(),s=f.decodeProposalId(e.proposalId),o=s.id,i=r.TokenVoting__factory.connect(s.pluginAddress,a),n.next=5,_(i.vote(o,e.vote,!1));case 5:return u=n.sent,n.next=8,{key:exports.VoteProposalStep.VOTING,txHash:u.hash};case 8:return n.next=10,_(u.wait());case 10:return n.next=12,{key:exports.VoteProposalStep.DONE};case 12:case"end":return n.stop()}}),n)})))()},n.executeProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.web3.getConnectedSigner(),s=f.decodeProposalId(e),o=s.id,i=r.TokenVoting__factory.connect(s.pluginAddress,a),n.next=5,_(i.execute(o));case 5:return u=n.sent,n.next=8,{key:exports.ExecuteProposalStep.EXECUTING,txHash:u.hash};case 8:return n.next=10,_(u.wait());case 10:return n.next=12,{key:exports.ExecuteProposalStep.DONE};case 12:case"end":return n.stop()}}),n)})))()},n.prepareInstallation=function(e){var t=this;return T(x().mark((function r(){var n;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,_(t.web3.getProvider().getNetwork());case 2:if(v.getNetworkNameByAlias(n=r.sent.name)){r.next=7;break}throw new f.UnsupportedNetworkError(n);case 7:return r.delegateYield(w(S(f.prepareGenericInstallation(t.web3,{daoAddressOrEns:e.daoAddressOrEns,pluginRepo:t.web3.getAddress(v.NonFrameworkContractsNames.TOKEN_VOTING_REPO_PROXY),version:e.versionTag,installationAbi:ln,installationParams:Qr(e.settings),pluginSetupProcessorAddress:t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)}))),"t0",8);case 8:case"end":return r.stop()}}),r)})))()},n.prepareUpdate=function(e){var t=this;return T(x().mark((function r(){return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(w(S(f.prepareGenericUpdate(t.web3,t.graphql,D({},e,{pluginRepo:t.web3.getAddress(v.NonFrameworkContractsNames.TOKEN_VOTING_REPO_PROXY),updateAbi:pn[e.newVersion.build]||e.updateAbi||[],pluginSetupProcessorAddress:t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)})))),"t0",1);case 1:case"end":return r.stop()}}),r)})))()},n.wrapTokens=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.web3.getConnectedSigner(),g.isAddress(e.wrappedTokenAddress)){n.next=3;break}throw new f.InvalidAddressError;case 3:return s=r.GovernanceWrappedERC20__factory.connect(e.wrappedTokenAddress,a),n.next=6,_(a.getAddress());case 6:return o=n.sent,n.next=9,_(s.depositFor(o,e.amount));case 9:return i=n.sent,n.next=12,{key:exports.WrapTokensStep.WRAPPING,txHash:i.hash};case 12:return n.next=14,_(i.wait());case 14:return n.next=16,{key:exports.WrapTokensStep.DONE};case 16:case"end":return n.stop()}}),n)})))()},n.unwrapTokens=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.web3.getConnectedSigner(),g.isAddress(e.wrappedTokenAddress)){n.next=3;break}throw new f.InvalidAddressError;case 3:return s=r.GovernanceWrappedERC20__factory.connect(e.wrappedTokenAddress,a),n.next=6,_(a.getAddress());case 6:return o=n.sent,n.next=9,_(s.withdrawTo(o,e.amount));case 9:return i=n.sent,n.next=12,{key:exports.UnwrapTokensStep.UNWRAPPING,txHash:i.hash};case 12:return n.next=14,_(i.wait());case 14:return n.next=16,{key:exports.UnwrapTokensStep.DONE};case 16:case"end":return n.stop()}}),n)})))()},n.delegateTokens=function(e){var t=this;return T(x().mark((function n(){var a,s,o;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.web3.getConnectedSigner(),s=r.GovernanceERC20__factory.connect(e.tokenAddress,a),n.next=4,_(s.delegate(e.delegatee));case 4:return o=n.sent,n.next=7,{key:"delegating",txHash:o.hash};case 7:return n.next=9,_(o.wait());case 9:return n.next=11,{key:"done"};case 11:case"end":return n.stop()}}),n)})))()},n.undelegateTokens=function(e){var t=this;return T(x().mark((function r(){var n;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=t.web3.getConnectedSigner(),r.t0=w,r.t1=S,r.t2=t,r.t3=e,r.next=7,_(n.getAddress());case 7:return r.t4=r.sent,r.t5={tokenAddress:r.t3,delegatee:r.t4},r.t6=r.t2.delegateTokens.call(r.t2,r.t5),r.t7=(0,r.t1)(r.t6),r.t8=_,r.delegateYield((0,r.t0)(r.t7,r.t8),"t9",13);case 13:case"end":return r.stop()}}),r)})))()},n.getDelegatee=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getConnectedSigner(),a=r.GovernanceERC20__factory.connect(t,n),e.next=4,n.getAddress();case 4:return s=e.sent,e.next=7,a.delegates(s);case 7:return e.abrupt("return",s===(o=e.sent)?null:o);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.canVote=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.web3.getProvider(),g.isAddress(t.voterAddressOrEns)){e.next=3;break}throw new f.InvalidAddressError;case 3:return a=f.decodeProposalId(t.proposalId),s=a.id,o=r.TokenVoting__factory.connect(a.pluginAddress,n),e.abrupt("return",o.callStatic.canVote(s,t.voterAddressOrEns,t.vote));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.canExecute=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getProvider(),a=f.decodeProposalId(t),s=a.id,o=r.TokenVoting__factory.connect(a.pluginAddress,n),e.abrupt("return",o.canExecute(s));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getMembers=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.blockNumber,s=void 0===(a=t.limit)?10:a,i=void 0===(o=t.skip)?0:o,c=void 0===(u=t.direction)?f.SortDirection.ASC:u,p=void 0===(d=t.sortBy)?kr.VOTING_POWER:d,g.isAddress(r=t.pluginAddress)){e.next=3;break}throw new f.InvalidAddressError;case 3:return l=Zr,m={where:{plugin:r.toLowerCase()},block:n?{number:n}:null,skip:i,limit:s,direction:c,sortBy:p},e.next=8,this.graphql.request({query:l,params:m,name:"TokenVoting members"});case 8:return e.abrupt("return",e.sent.tokenVotingMembers.map((function(e){return tn(e)})));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getProposal=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.isProposalId(t)){e.next=2;break}throw new f.InvalidProposalIdError;case 2:return r=f.getExtendedProposalId(t),n=Wr,a={proposalId:r},e.next=8,this.graphql.request({query:n,params:a,name:"TokenVoting proposal"});case 8:if(s=e.sent.tokenVotingProposal){e.next=14;break}return e.abrupt("return",null);case 14:if(s.metadata){e.next=16;break}return e.abrupt("return",zr(s,f.EMPTY_PROPOSAL_METADATA_LINK));case 16:return e.prev=16,o=f.resolveIpfsCid(s.metadata),e.next=20,this.ipfs.fetchString(o);case 20:return i=JSON.parse(e.sent),e.abrupt("return",zr(s,i));case 25:if(e.prev=25,e.t0=e.catch(16),!(e.t0 instanceof f.InvalidCidError)){e.next=29;break}return e.abrupt("return",zr(s,f.UNSUPPORTED_PROPOSAL_METADATA_LINK));case 29:return e.abrupt("return",zr(s,f.UNAVAILABLE_PROPOSAL_METADATA));case 30:case"end":return e.stop()}}),e,this,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),n.getProposals=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m,h,v,A,I=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0===(r=t.limit)?10:r,a=t.status,o=void 0===(s=t.skip)?0:s,u=void 0===(i=t.direction)?f.SortDirection.ASC:i,d=void 0===(c=t.sortBy)?exports.ProposalSortBy.CREATED_AT:c,p={},!(l=t.daoAddressOrEns)){e.next=23;break}if(g.isAddress(l)){e.next=22;break}return e.next=7,this.web3.ensureOnline();case 7:if(m=this.web3.getProvider()){e.next=10;break}throw new f.NoProviderError;case 10:return e.prev=10,e.next=13,m.resolveName(l);case 13:if(h=e.sent){e.next=16;break}throw new f.InvalidAddressOrEnsError;case 16:l=h,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new f.InvalidAddressOrEnsError(e.t0);case 22:p={dao:l.toLowerCase()};case 23:return a&&(p=D({},p,nn(a))),v=jr,A={where:p,limit:n,skip:o,direction:u,sortBy:d},e.next=29,this.graphql.request({query:v,params:A,name:"TokenVoting proposals"});case 29:return e.abrupt("return",Promise.all(e.sent.tokenVotingProposals.map(function(){var e=O(x().mark((function e(t){var r,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.metadata){e.next=2;break}return e.abrupt("return",Jr(t,f.EMPTY_PROPOSAL_METADATA_LINK));case 2:return e.prev=2,r=f.resolveIpfsCid(t.metadata),e.next=6,f.promiseWithTimeout(I.ipfs.fetchString(r),f.MULTI_FETCH_TIMEOUT);case 6:return n=JSON.parse(e.sent),e.abrupt("return",Jr(t,n));case 11:if(e.prev=11,e.t0=e.catch(2),!(e.t0 instanceof f.InvalidCidError)){e.next=15;break}return e.abrupt("return",Jr(t,f.UNSUPPORTED_PROPOSAL_METADATA_LINK));case 15:return e.abrupt("return",Jr(t,f.UNAVAILABLE_PROPOSAL_METADATA));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())));case 32:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),n.getVotingSettings=function(){var e=O(x().mark((function e(t,r){var n,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.isAddress(t)){e.next=2;break}throw new f.InvalidAddressError;case 2:return n=Kr,a={address:t.toLowerCase(),block:r?{number:r}:null},e.next=7,this.graphql.request({query:n,params:a,name:"TokenVoting settings"});case 7:if(s=e.sent.tokenVotingPlugin){e.next=11;break}return e.abrupt("return",null);case 11:return e.abrupt("return",{minDuration:parseInt(s.minDuration),supportThreshold:f.decodeRatio(BigInt(s.supportThreshold),6),minParticipation:f.decodeRatio(BigInt(s.minParticipation),6),minProposerVotingPower:BigInt(s.minProposerVotingPower),votingMode:s.votingMode});case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),n.getToken=function(){var e=O(x().mark((function e(t){var r,n,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.isAddress(t)){e.next=2;break}throw new f.InvalidAddressError;case 2:return r=Yr,n={address:t.toLowerCase()},e.next=7,this.graphql.request({query:r,params:n,name:"TokenVoting token"});case 7:if(a=e.sent.tokenVotingPlugin){e.next=11;break}return e.abrupt("return",null);case 11:if((s=a.token).__typename!==Tr.ERC20){e.next=16;break}return e.abrupt("return",{address:s.id,name:s.name,symbol:s.symbol,decimals:s.decimals,type:f.TokenType.ERC20});case 16:if(s.__typename!==Tr.ERC721){e.next=20;break}return e.abrupt("return",{address:s.id,name:s.name,symbol:s.symbol,type:f.TokenType.ERC721});case 20:if(s.__typename!==Tr.ERC20_WRAPPER){e.next=22;break}return e.abrupt("return",{address:s.id,name:s.name,symbol:s.symbol,decimals:s.decimals,underlyingToken:{address:s.underlyingToken.id,name:s.underlyingToken.name,symbol:s.underlyingToken.symbol,decimals:s.underlyingToken.decimals,type:f.TokenType.ERC20},type:f.TokenType.ERC20});case 22:return e.abrupt("return",null);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.isTokenVotingCompatibleToken=function(){var e=O(x().mark((function e(t){var r,n,a,i,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.isAddress(t)&&t!==s.AddressZero){e.next=2;break}throw new f.InvalidAddressError;case 2:return r=this.web3.getProvider(),e.next=5,r.getCode(t);case 5:if(e.t0=e.sent,"0x"!==e.t0){e.next=8;break}throw new f.NotAContractError;case 8:return n=new o.Contract(t,y.abi,r),e.next=11,an(t,r);case 11:if(e.sent){e.next=13;break}return e.abrupt("return",Or.INCOMPATIBLE);case 13:return e.prev=13,e.next=16,n.supportsInterface(fn);case 16:if(e.sent){e.next=18;break}return e.abrupt("return",Or.NEEDS_WRAPPING);case 18:a=V(mn);case 19:if((i=a()).done){e.next=28;break}return u=i.value,e.next=23,n.supportsInterface(u);case 23:if(!e.sent){e.next=26;break}return e.abrupt("return",Or.COMPATIBLE);case 26:e.next=19;break;case 28:return e.abrupt("return",Or.NEEDS_WRAPPING);case 31:return e.prev=31,e.t1=e.catch(13),e.abrupt("return",Or.NEEDS_WRAPPING);case 34:case"end":return e.stop()}}),e,this,[[13,31]])})));return function(t){return e.apply(this,arguments)}}(),n.isMember=function(){var e=O(x().mark((function e(t){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.IsMemberSchema.strict().validateSync(t),r=Xr,e.next=5,this.graphql.request({query:r,params:{id:t.pluginAddress.toLowerCase()+"_"+t.address.toLowerCase(),blockHeight:t.blockNumber?{number:t.blockNumber}:null},name:"TokenVoting isMember"});case 5:return e.abrupt("return",!!e.sent.tokenVotingMember);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(f.ClientCore),hn=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t.getPluginInstallItem=function(e,t){var r,a=f.getNetwork(t).name,s=v.getNetworkNameByAlias(a);if(!s)throw new f.UnsupportedNetworkError(a);var o=Qr(e),i=n.defaultAbiCoder.encode(f.getNamedTypesFromMetadata(ln),o),u=null==(r=v.contracts[s][v.SupportedVersions.V1_3_0])||null==(r=r.TokenVotingRepoProxy)?void 0:r.address;if(!u)throw new Error;return{id:u,data:f.hexToBytes(i)}};var s=t.prototype;return s.updatePluginSettingsAction=function(e,t){if(!g.isAddress(e))throw new f.InvalidAddressError;return{to:e,value:BigInt(0),data:pr(t)}},s.mintTokenAction=function(e,t){if(!g.isAddress(e)||!g.isAddress(t.address))throw new f.InvalidAddressError;var n=r.IERC20MintableUpgradeable__factory.createInterface(),s=function(e){return[e.address,a.BigNumber.from(e.amount)]}(t),o=n.encodeFunctionData("mint",s);return{to:e,value:BigInt(0),data:f.hexToBytes(o)}},t}(f.ClientCore),vn=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.updatePluginSettingsAction=function(e){return dr(e)},n.mintTokenAction=function(e){var t,n=r.IERC20MintableUpgradeable__factory.createInterface(),a=f.bytesToHex(e),s=n.getFunction("mint");return{address:(t=n.decodeFunctionData(s,a))[0],amount:BigInt(t[1])}},n.findInterface=function(e){try{var t=f.getFunctionFragment(e,dn);return{id:t.format("minimal"),functionName:t.name,hash:f.bytesToHex(e).substring(0,10)}}catch(e){return null}},t}(f.ClientCore),An=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.createProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o,i,u,c,d,p;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.web3.getConnectedSigner(),u=r.TokenVoting__factory.connect(t.pluginAddress,i),null==(n=t.failSafeActions)||!n.length||t.failSafeActions.length===(null==(a=t.actions)?void 0:a.length)){e.next=4;break}throw new f.SizeMismatchError("failSafeActions","actions");case 4:return c=f.boolArrayToBitmap(t.failSafeActions),d=(null==(s=t.startDate)?void 0:s.getTime())||0,p=(null==(o=t.endDate)?void 0:o.getTime())||0,e.next=9,u.estimateGas.createProposal(l.toUtf8Bytes(t.metadataUri),t.actions||[],c,Math.round(d/1e3),Math.round(p/1e3),t.creatorVote||0,t.executeOnPass||!1);case 9:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.voteProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getConnectedSigner(),a=f.decodeProposalId(t.proposalId),s=a.id,o=r.TokenVoting__factory.connect(a.pluginAddress,n),e.next=5,o.estimateGas.vote(s,t.vote,!1);case 5:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.executeProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getConnectedSigner(),a=f.decodeProposalId(t),s=a.id,o=r.TokenVoting__factory.connect(a.pluginAddress,n),e.next=5,o.estimateGas.execute(s);case 5:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.delegateTokens=function(){var e=O(x().mark((function e(t){var n,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getConnectedSigner(),a=r.GovernanceERC20__factory.connect(t.tokenAddress,n),e.next=4,a.estimateGas.delegate(t.delegatee);case 4:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.undelegateTokens=function(){var e=O(x().mark((function e(t){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.web3.getConnectedSigner(),e.t0=this,e.t1=t,e.next=5,r.getAddress();case 5:return e.t2=e.sent,e.t3={tokenAddress:e.t1,delegatee:e.t2},e.abrupt("return",e.t0.delegateTokens.call(e.t0,e.t3));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.prepareUpdate=function(){var e=O(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.prepareGenericUpdateEstimation(this.web3,this.graphql,D({},t,{pluginSetupProcessorAddress:this.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR),pluginRepo:this.web3.getAddress(v.NonFrameworkContractsNames.TOKEN_VOTING_REPO_PROXY)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(f.ClientCore),In=function(e){function t(t){var r;return(r=e.call(this,t)||this).methods=new gn(t),r.encoding=new hn(t),r.decoding=new vn(t),r.estimation=new An(t),r}return R(t,e),t}(f.ClientCore);In.encoding={getPluginInstallItem:function(e,t){return hn.getPluginInstallItem(e,t)}},exports.ApproveProposalStep=void 0,(on=exports.ApproveProposalStep||(exports.ApproveProposalStep={})).APPROVING="approving",on.DONE="done";var yn,En,Pn,wn=d.gql(un||(un=C(["\nquery MultisigProposal($proposalId: ID!) {\n  multisigProposal(id: $proposalId){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    createdAt\n    startDate\n    endDate\n    actions {\n      to\n      value\n      data\n    }\n    executionDate\n    executionBlockNumber\n    creationBlockNumber\n    plugin {\n      onlyListed\n    }\n    minApprovals\n    executionTxHash\n    executed\n    approvalReached\n    isSignaling\n    approvals(first: 1000){\n      approver{\n        address\n      }\n    }\n  }\n}\n"]))),Sn=d.gql(cn||(cn=C(["\nquery MultisigProposals($where: MultisigProposal_filter!, $limit:Int!, $skip: Int!, $direction: OrderDirection!, $sortBy: MultisigProposal_orderBy!) {\n  multisigProposals(where: $where, first: $limit, skip: $skip, orderDirection: $direction, orderBy: $sortBy){\n    id\n    dao {\n      id\n      subdomain\n    }\n    creator\n    metadata\n    executed\n    approvalReached\n    isSignaling\n    approvalCount\n    startDate\n    endDate\n    executionDate\n    executionBlockNumber\n    creationBlockNumber\n    approvals(first: 1000){\n      approver{\n        address\n      }\n    }\n    actions {\n      to\n      value\n      data\n    }\n    minApprovals\n    plugin{\n      onlyListed\n    }\n  }\n}\n"]))),bn=d.gql(yn||(yn=C(["\nquery MultisigVotingSettings($address: ID!, $block: Block_height) {\n    multisigPlugin(id: $address, block: $block){\n        minApprovals\n        onlyListed\n    }\n}\n"]))),_n=d.gql(En||(En=C(["\nquery MultisigMembers($where: MultisigApprover_filter!, $block: Block_height, $limit: Int!, $skip: Int!, $sortBy: MultisigApprover_orderBy!, $direction: OrderDirection!) {\n  multisigApprovers(\n    where: $where\n    block: $block\n    first: $limit\n    skip: $skip\n    orderBy: $sortBy\n    orderDirection: $direction\n  ) {\n    address\n    isActive\n  }\n}\n"]))),xn=d.gql(Pn||(Pn=C(["\nquery MultisigIsMember($id: ID!, $block: Block_height) {\n  multisigApprover(\n    id: $id\n    block: $block\n  ) {\n    id\n  }\n}"])));function Tn(e,t){var r=new Date(1e3*parseInt(e.createdAt)),n=new Date(1e3*parseInt(e.startDate)),a=new Date(1e3*parseInt(e.endDate)),s=e.executionDate?new Date(1e3*parseInt(e.executionDate)):null;return{id:f.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:t.title,summary:t.summary,description:t.description,resources:t.resources,media:t.media},metadataHash:e.metadata,settings:{onlyListed:e.plugin.onlyListed,minApprovals:e.minApprovals},creationBlockNumber:parseInt(e.creationBlockNumber)||0,creationDate:r,startDate:n,endDate:a,executionDate:s,executionBlockNumber:parseInt(e.executionBlockNumber)||null,executionTxHash:e.executionTxHash||null,actions:e.actions.map((function(e){return{data:f.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}})),status:On(e),approvals:e.approvals.map((function(e){return e.approver.address}))}}function kn(e,t){var r=new Date(1e3*parseInt(e.startDate)),n=new Date(1e3*parseInt(e.endDate));return{id:f.getCompactProposalId(e.id),dao:{address:e.dao.id,name:e.dao.subdomain},creatorAddress:e.creator,metadata:{title:t.title,summary:t.summary},metadataHash:e.metadata,approvals:e.approvals.map((function(e){return e.approver.address})),actions:e.actions.map((function(e){return{data:f.hexToBytes(e.data),to:e.to,value:BigInt(e.value)}})),settings:{onlyListed:e.plugin.onlyListed,minApprovals:e.minApprovals},startDate:r,endDate:n,status:On(e)}}function On(e){var t=new Date,r=new Date(1e3*parseInt(e.startDate)),n=new Date(1e3*parseInt(e.endDate));if(e.executed)return f.ProposalStatus.EXECUTED;if(r>=t)return f.ProposalStatus.PENDING;if(e.approvalReached){if(e.isSignaling)return f.ProposalStatus.SUCCEEDED;if(t<=n)return f.ProposalStatus.SUCCEEDED}return t<=n?f.ProposalStatus.ACTIVE:f.ProposalStatus.DEFEATED}function Dn(e){var t={},r=Math.round((new Date).getTime()/1e3).toString();switch(e){case f.ProposalStatus.PENDING:t={startDate_gte:r};break;case f.ProposalStatus.ACTIVE:t={startDate_lt:r,endDate_gte:r,executed:!1};break;case f.ProposalStatus.EXECUTED:t={executed:!0};break;case f.ProposalStatus.SUCCEEDED:t={or:[{approvalReached:!0,endDate_lt:r,isSignaling:!1},{approvalReached:!0,isSignaling:!0}]};break;case f.ProposalStatus.DEFEATED:t={endDate_lt:r,executed:!1};break;default:throw new f.InvalidProposalStatusError}return t}var Rn=[r.Multisig__factory.createInterface().getFunction("addAddresses").format("minimal"),r.Multisig__factory.createInterface().getFunction("removeAddresses").format("minimal"),r.Multisig__factory.createInterface().getFunction("updateMultisigSettings").format("minimal")],Nn={1:[]},Cn=[{internalType:"address[]",name:"members",type:"address[]",description:"The addresses of the initial members to be added."},{components:[{internalType:"bool",name:"onlyListed",type:"bool",description:"Whether only listed addresses can create a proposal or not."},{internalType:"uint16",name:"minApprovals",type:"uint16",description:"The minimal number of approvals required for a proposal to pass."}],internalType:"struct Multisig.MultisigSettings",name:"multisigSettings",type:"tuple",description:"The inital multisig settings."}],Un=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.createProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u,c,d,p,m,g,h,v,A,I,y;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(u=t.web3.getConnectedSigner(),c=r.Multisig__factory.connect(e.pluginAddress,u),null==(a=e.failSafeActions)||!a.length||e.failSafeActions.length===(null==(s=e.actions)?void 0:s.length)){n.next=4;break}throw new f.SizeMismatchError("failSafeActions","actions");case 4:return d=f.boolArrayToBitmap(e.failSafeActions),p=(null==(o=e.startDate)?void 0:o.getTime())||0,m=(null==(i=e.endDate)?void 0:i.getTime())||0,n.next=9,_(c.createProposal(l.toUtf8Bytes(e.metadataUri),e.actions||[],d,e.approve||!1,e.tryExecution||!1,Math.round(p/1e3),Math.round(m/1e3)));case 9:return g=n.sent,n.next=12,{key:exports.ProposalCreationSteps.CREATING,txHash:g.hash};case 12:return n.next=14,_(g.wait());case 14:if(h=n.sent,v=r.Multisig__factory.createInterface(),A=f.findLog(h,v,"ProposalCreated")){n.next=19;break}throw new f.ProposalCreationError;case 19:if(I=v.parseLog(A),y=I.args.proposalId){n.next=23;break}throw new f.ProposalCreationError;case 23:return n.next=25,{key:exports.ProposalCreationSteps.DONE,proposalId:f.encodeProposalId(e.pluginAddress,Number(y))};case 25:case"end":return n.stop()}}),n)})))()},n.pinMetadata=function(){var e=O(x().mark((function e(t){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.ipfs.add(JSON.stringify(t));case 3:return r=e.sent,e.next=6,this.ipfs.pin(r);case 6:return e.abrupt("return","ipfs://"+r);case 9:throw e.prev=9,e.t0=e.catch(0),new f.IpfsPinError(e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),n.approveProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.web3.getConnectedSigner(),s=f.decodeProposalId(e.proposalId),o=s.id,i=r.Multisig__factory.connect(s.pluginAddress,a),n.next=5,_(i.approve(o,e.tryExecution));case 5:return u=n.sent,n.next=8,{key:exports.ApproveProposalStep.APPROVING,txHash:u.hash};case 8:return n.next=10,_(u.wait());case 10:return n.next=12,{key:exports.ApproveProposalStep.DONE};case 12:case"end":return n.stop()}}),n)})))()},n.executeProposal=function(e){var t=this;return T(x().mark((function n(){var a,s,o,i,u;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.web3.getConnectedSigner(),s=f.decodeProposalId(e),o=s.id,i=r.Multisig__factory.connect(s.pluginAddress,a),n.next=5,_(i.execute(o));case 5:return u=n.sent,n.next=8,{key:exports.ExecuteProposalStep.EXECUTING,txHash:u.hash};case 8:return n.next=10,_(u.wait());case 10:return n.next=12,{key:exports.ExecuteProposalStep.DONE};case 12:case"end":return n.stop()}}),n)})))()},n.prepareInstallation=function(e){var t=this;return T(x().mark((function r(){var n;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,_(t.web3.getProvider().getNetwork());case 2:if(v.getNetworkNameByAlias(n=r.sent.name)){r.next=7;break}throw new f.UnsupportedNetworkError(n);case 7:return r.delegateYield(w(S(f.prepareGenericInstallation(t.web3,{daoAddressOrEns:e.daoAddressOrEns,pluginRepo:t.web3.getAddress(v.NonFrameworkContractsNames.MULTISIG_REPO_PROXY),version:e.versionTag,installationAbi:Cn,installationParams:[e.settings.members,[e.settings.votingSettings.onlyListed,e.settings.votingSettings.minApprovals]],pluginSetupProcessorAddress:t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)}))),"t0",8);case 8:case"end":return r.stop()}}),r)})))()},n.prepareUpdate=function(e){var t=this;return T(x().mark((function r(){return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.delegateYield(w(S(f.prepareGenericUpdate(t.web3,t.graphql,D({},e,{pluginRepo:t.web3.getAddress(v.NonFrameworkContractsNames.MULTISIG_REPO_PROXY),updateAbi:Nn[e.newVersion.build]||e.updateAbi||[],pluginSetupProcessorAddress:t.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR)})))),"t0",1);case 1:case"end":return r.stop()}}),r)})))()},n.canApprove=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.web3.getProvider(),g.isAddress(t.approverAddressOrEns)){e.next=3;break}throw new f.InvalidAddressOrEnsError;case 3:return a=f.decodeProposalId(t.proposalId),s=a.id,o=r.Multisig__factory.connect(a.pluginAddress,n),e.abrupt("return",o.canApprove(s,t.approverAddressOrEns));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.canExecute=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getProvider(),a=f.decodeProposalId(t),s=a.id,o=r.Multisig__factory.connect(a.pluginAddress,n),e.abrupt("return",o.canExecute(s));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getVotingSettings=function(){var e=O(x().mark((function e(t,r){var n,a,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g.isAddress(t)){e.next=2;break}throw new f.InvalidAddressOrEnsError;case 2:return n=bn,a={address:t.toLowerCase(),block:r?{number:r}:null},e.next=7,this.graphql.request({query:n,params:a,name:"Multisig settings"});case 7:return e.abrupt("return",{onlyListed:(s=e.sent.multisigPlugin).onlyListed,minApprovals:s.minApprovals});case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),n.getMembers=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.pluginAddress,n=t.blockNumber,s=void 0===(a=t.limit)?10:a,i=void 0===(o=t.skip)?0:o,c=void 0===(u=t.direction)?f.SortDirection.ASC:u,p=void 0===(d=t.sortBy)?exports.MembersSortBy.ADDRESS:d,g.isAddress(r)){e.next=3;break}throw new f.InvalidAddressOrEnsError;case 3:return l=_n,m={where:{plugin:r.toLowerCase()},block:n?{number:n}:null,skip:i,limit:s,direction:c,sortBy:p},e.next=8,this.graphql.request({query:l,params:m,name:"Multisig members"});case 8:return e.abrupt("return",e.sent.multisigApprovers.filter((function(e){return e.isActive})).map((function(e){return e.address})));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.getProposal=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.isProposalId(t)){e.next=2;break}throw new f.InvalidProposalIdError;case 2:return r=f.getExtendedProposalId(t),n=wn,a={proposalId:r},e.next=8,this.graphql.request({query:n,params:a,name:"Multisig proposal"});case 8:if(s=e.sent.multisigProposal){e.next=14;break}return e.abrupt("return",null);case 14:if(s.metadata){e.next=16;break}return e.abrupt("return",Tn(s,f.EMPTY_PROPOSAL_METADATA_LINK));case 16:return e.prev=16,o=f.resolveIpfsCid(s.metadata),e.next=20,this.ipfs.fetchString(o);case 20:return i=JSON.parse(e.sent),e.abrupt("return",Tn(s,i));case 25:if(e.prev=25,e.t0=e.catch(16),!(e.t0 instanceof f.InvalidCidError)){e.next=29;break}return e.abrupt("return",Tn(s,f.UNSUPPORTED_PROPOSAL_METADATA_LINK));case 29:return e.abrupt("return",Tn(s,f.UNAVAILABLE_PROPOSAL_METADATA));case 30:case"end":return e.stop()}}),e,this,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),n.getProposals=function(){var e=O(x().mark((function e(t){var r,n,a,s,o,i,u,c,d,p,l,m,h,v,A,I=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0===(r=t.limit)?10:r,a=t.status,o=void 0===(s=t.skip)?0:s,u=void 0===(i=t.direction)?f.SortDirection.ASC:i,d=void 0===(c=t.sortBy)?exports.ProposalSortBy.CREATED_AT:c,p={},!(l=t.daoAddressOrEns)){e.next=23;break}if(g.isAddress(l)){e.next=22;break}return e.next=7,this.web3.ensureOnline();case 7:if(m=this.web3.getProvider()){e.next=10;break}throw new f.NoProviderError;case 10:return e.prev=10,e.next=13,m.resolveName(l);case 13:if(h=e.sent){e.next=16;break}throw new f.InvalidAddressOrEnsError;case 16:l=h,e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new f.InvalidAddressOrEnsError(e.t0);case 22:p={dao:l.toLowerCase()};case 23:return a&&(p=D({},p,Dn(a))),v=Sn,A={where:p,limit:n,skip:o,direction:u,sortBy:d},e.next=29,this.graphql.request({query:v,params:A,name:"Multisig proposals"});case 29:return e.abrupt("return",Promise.all(e.sent.multisigProposals.map(function(){var e=O(x().mark((function e(t){var r,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.metadata){e.next=2;break}return e.abrupt("return",kn(t,f.EMPTY_PROPOSAL_METADATA_LINK));case 2:return e.prev=2,r=f.resolveIpfsCid(t.metadata),e.next=6,f.promiseWithTimeout(I.ipfs.fetchString(r),f.MULTI_FETCH_TIMEOUT);case 6:return n=JSON.parse(e.sent),e.abrupt("return",kn(t,n));case 11:if(e.prev=11,e.t0=e.catch(2),!(e.t0 instanceof f.InvalidCidError)){e.next=15;break}return e.abrupt("return",kn(t,f.UNSUPPORTED_PROPOSAL_METADATA_LINK));case 15:return e.abrupt("return",kn(t,f.UNAVAILABLE_PROPOSAL_METADATA));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}())));case 32:case"end":return e.stop()}}),e,this,[[10,19]])})));return function(t){return e.apply(this,arguments)}}(),n.isMember=function(){var e=O(x().mark((function e(t){var r;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.IsMemberSchema.strict().validateSync(t),r=xn,e.next=5,this.graphql.request({query:r,params:{id:t.pluginAddress.toLowerCase()+"_"+t.address.toLowerCase(),blockHeight:t.blockNumber?{number:t.blockNumber}:null},name:"multisig isMember"});case 5:return e.abrupt("return",!!e.sent.multisigApprover);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(f.ClientCore),Vn=function(e){function t(){return e.apply(this,arguments)||this}R(t,e),t.getPluginInstallItem=function(e,t){var r,a=f.getNetwork(t).name,s=v.getNetworkNameByAlias(a);if(!s)throw new f.UnsupportedNetworkError(a);var o=n.defaultAbiCoder.encode(f.getNamedTypesFromMetadata(Cn),[e.members,[e.votingSettings.onlyListed,e.votingSettings.minApprovals]]),i=null==(r=v.contracts[s][v.SupportedVersions.V1_3_0])||null==(r=r.MultisigRepoProxy)?void 0:r.address;if(!i)throw new Error("AddresslistVotingRepoProxy address not found");return{id:i,data:f.hexToBytes(o)}};var a=t.prototype;return a.addAddressesAction=function(e){if(!g.isAddress(e.pluginAddress))throw new f.InvalidAddressError;for(var t,n=V(e.members);!(t=n()).done;)if(!g.isAddress(t.value))throw new f.InvalidAddressError;var a=r.Multisig__factory.createInterface().encodeFunctionData("addAddresses",[e.members]);return{to:e.pluginAddress,value:BigInt(0),data:f.hexToBytes(a)}},a.removeAddressesAction=function(e){if(!g.isAddress(e.pluginAddress))throw new f.InvalidAddressError;for(var t,n=V(e.members);!(t=n()).done;)if(!g.isAddress(t.value))throw new f.InvalidAddressError;var a=r.Multisig__factory.createInterface().encodeFunctionData("removeAddresses",[e.members]);return{to:e.pluginAddress,value:BigInt(0),data:f.hexToBytes(a)}},a.updateMultisigVotingSettings=function(e){if(!g.isAddress(e.pluginAddress))throw new f.InvalidAddressError;var t=r.Multisig__factory.createInterface().encodeFunctionData("updateMultisigSettings",[e.votingSettings]);return{to:e.pluginAddress,value:BigInt(0),data:f.hexToBytes(t)}},t}(f.ClientCore),Ln=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.addAddressesAction=function(e){var t=r.Multisig__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("addAddresses");return t.decodeFunctionData(a,n)[0]},n.removeAddressesAction=function(e){var t=r.Multisig__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("removeAddresses");return t.decodeFunctionData(a,n)[0]},n.updateMultisigVotingSettings=function(e){var t=r.Multisig__factory.createInterface(),n=f.bytesToHex(e),a=t.getFunction("updateMultisigSettings"),s=t.decodeFunctionData(a,n);return{minApprovals:s[0].minApprovals,onlyListed:s[0].onlyListed}},n.findInterface=function(e){try{var t=f.getFunctionFragment(e,Rn);return{id:t.format("minimal"),functionName:t.name,hash:f.bytesToHex(e).substring(0,10)}}catch(e){return null}},t}(f.ClientCore),Bn=function(e){function t(){return e.apply(this,arguments)||this}R(t,e);var n=t.prototype;return n.createProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o,i,u,c,d,p;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.web3.getConnectedSigner(),u=r.Multisig__factory.connect(t.pluginAddress,i),null==(n=t.failSafeActions)||!n.length||t.failSafeActions.length===(null==(a=t.actions)?void 0:a.length)){e.next=4;break}throw new f.SizeMismatchError("failSafeActions","actions");case 4:return c=f.boolArrayToBitmap(t.failSafeActions),d=(null==(s=t.startDate)?void 0:s.getTime())||0,p=(null==(o=t.endDate)?void 0:o.getTime())||0,e.next=9,u.estimateGas.createProposal(l.toUtf8Bytes(t.metadataUri),t.actions||[],c,t.approve||!1,t.tryExecution||!0,Math.round(d/1e3),Math.round(p/1e3));case 9:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.approveProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getConnectedSigner(),a=f.decodeProposalId(t.proposalId),s=a.id,o=r.Multisig__factory.connect(a.pluginAddress,n),e.next=5,o.estimateGas.approve(s,t.tryExecution);case 5:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.executeProposal=function(){var e=O(x().mark((function e(t){var n,a,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.web3.getConnectedSigner(),a=f.decodeProposalId(t),s=a.id,o=r.Multisig__factory.connect(a.pluginAddress,n),e.next=5,o.estimateGas.execute(s);case 5:return e.abrupt("return",this.web3.getApproximateGasFee(e.sent.toBigInt()));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.prepareUpdate=function(){var e=O(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.prepareGenericUpdateEstimation(this.web3,this.graphql,D({},t,{pluginSetupProcessorAddress:this.web3.getAddress(v.FrameworkContractsNames.PLUGIN_SETUP_PROCESSOR),pluginRepo:this.web3.getAddress(v.NonFrameworkContractsNames.MULTISIG_REPO_PROXY)}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t}(f.ClientCore),Mn=function(e){function t(t){var r;return(r=e.call(this,t)||this).methods=new Un(t),r.encoding=new Vn(t),r.decoding=new Ln(t),r.estimation=new Bn(t),r}return R(t,e),t}(f.ClientCore);Mn.encoding={getPluginInstallItem:function(e,t){return Vn.getPluginInstallItem(e,t)}},Object.defineProperty(exports,"Context",{enumerable:!0,get:function(){return f.Context}}),Object.defineProperty(exports,"PermissionIds",{enumerable:!0,get:function(){return f.PermissionIds}}),Object.defineProperty(exports,"Permissions",{enumerable:!0,get:function(){return f.Permissions}}),Object.defineProperty(exports,"PrepareInstallationStep",{enumerable:!0,get:function(){return f.PrepareInstallationStep}}),Object.defineProperty(exports,"PrepareUpdateStep",{enumerable:!0,get:function(){return f.PrepareUpdateStep}}),exports.AddresslistVotingClient=Gr,exports.Client=zt,exports.MultisigClient=Mn,exports.SubgraphVoteValuesMap=tr,exports.TokenVotingClient=In,exports.applyInstallatonParamsFromContract=function(e){var t=e[1];return{helpersHash:t.helpersHash,permissions:t.permissions,versionTag:t.pluginSetupRef.versionTag,pluginAddress:t.plugin,pluginRepo:t.pluginSetupRef.pluginSetupRepo}},exports.decodeUpdatePluginSettingsAction=dr,exports.encodeUpdateVotingSettingsAction=pr,exports.isFailingProposal=function(e){void 0===e&&(e=[]);for(var t,r=e.map((function(e){try{return f.getFunctionFragment(e.data,ir).name}catch(e){return""}})).filter((function(e){return""!==e})),n=V(r.entries());!(t=n()).done;){var a=t.value,s=a[0],o=a[1];if("addAddresses"===o){if(-1===r.indexOf("updateVotingSettings",s)&&-1===r.indexOf("updateMultisigSettings",s))return!0}else if("removeAddresses"===o){var i=r.indexOf("updateVotingSettings"),u=r.indexOf("updateMultisigSettings");if((-1===i||i>s)&&(-1===u||u>s))return!0}}return!1},exports.unwrapProposalParams=function(e){var t,r,n;return[e.metadataUri,null!=(t=e.actions)?t:[],e.startDate?Math.floor(e.startDate.getTime()/1e3):0,e.endDate?Math.floor(e.endDate.getTime()/1e3):0,null!=(r=e.executeOnPass)&&r,null!=(n=e.creatorVote)?n:exports.VoteValues.ABSTAIN]},exports.votingModeFromContracts=cr,exports.votingModeToContracts=ur,exports.votingSettingsToContract=lr;
//# sourceMappingURL=sdk-client.cjs.production.min.js.map
